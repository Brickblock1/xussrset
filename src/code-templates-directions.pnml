  /// code definition

// Выбор ориентации кабины случайным образом

#define engine_RNDany_direction_template(name, p1, p2)  \
switch (FEAT_TRAINS, SELF, name##_sprites_start_sp,     \
[  set_offset_to(1),                                    \
   (prev_vehicle_randombits() % (p1 + p2)) < p1])       \
{ 1: name##_sprites_left;                               \
     name##_sprites_right; }                            \

#define engine_RND_direction_template(name, vehid,  p1, p2)  \
switch (FEAT_TRAINS, SELF, name##_sprites_1RND,              \
[  set_offset_to(1),                                         \
   (prev_vehicle_randombits() % (p1 + p2)) < p1])            \
{ 1: name##_sprites_left;                                    \
     name##_sprites_right; }                                 \
switch (FEAT_TRAINS, PARENT, name##_sprites_start_sp,        \
  count_veh_id(vehid))                                       \
{ 1: name##_sprites_1RND;                                    \
     name##_sprites_start; }                                 \

#define engine_RND_direction_template2(name, vehid1, vehid2, p1, p2)  \
switch (FEAT_TRAINS, SELF, name##_sprites_1RND,                       \
[  set_offset_to(1),                                                  \
   (prev_vehicle_randombits() % (p1 + p2)) < p1])                     \
{ 1: name##_sprites_left;                                             \
     name##_sprites_right; }                                          \
switch (FEAT_TRAINS, PARENT, name##_sprites_start_sp,                 \
  count_veh_id(vehid1) +                                              \
  count_veh_id(vehid2))                                               \
{ 1: name##_sprites_1RND;                                             \
     name##_sprites_start; }                                          \

#define engine_RND_direction_template3(name, vehid1, vehid2, vehid3, p1, p2)  \
switch (FEAT_TRAINS, SELF, name##_sprites_1RND,                               \
[  set_offset_to(1),                                                          \
   (prev_vehicle_randombits() % (p1 + p2)) < p1])                             \
{ 1: name##_sprites_left;                                                     \
     name##_sprites_right; }                                                  \
switch (FEAT_TRAINS, PARENT, name##_sprites_start_sp,                         \
  count_veh_id(vehid1) +                                                      \
  count_veh_id(vehid2) +                                                      \
  count_veh_id(vehid3))                                                       \
{ 1: name##_sprites_1RND;                                                     \
     name##_sprites_start; }                                                  \

#define engine_RND_direction_template4(name, vehid1, vehid2, vehid3, vehid4, p1, p2)  \
switch (FEAT_TRAINS, SELF, name##_sprites_1RND,                                       \
[  set_offset_to(1),                                                                  \
   (prev_vehicle_randombits() % (p1 + p2)) < p1])                                     \
{ 1: name##_sprites_left;                                                             \
     name##_sprites_right; }                                                          \
switch (FEAT_TRAINS, PARENT, name##_sprites_start_sp,                                 \
  count_veh_id(vehid1) +                                                              \
  count_veh_id(vehid2) +                                                              \
  count_veh_id(vehid3) +                                                              \
  count_veh_id(vehid4))                                                               \
{ 1: name##_sprites_1RND;                                                             \
     name##_sprites_start; }                                                          \

// Выбор ориентации кабины секции для СМЕ без возможности сборки

#define engine_direction_template_only2(name)     \
switch (FEAT_TRAINS, SELF, name##_sprites_start,  \
  position_in_articulated_veh)                    \
{ 0: name##_sprites_left;                         \
  2: name##_sprites_right;                        \
  4: name##_sprites_left;                         \
  6: name##_sprites_right;                        \
  8: name##_sprites_left;                         \
 10: name##_sprites_right;                        \
 12: name##_sprites_left;                         \
     name##_sprites_right; }                      \

// Выбор ориентации кабины секции для СМЕ (схема без альтернатив в СМЕ)

#define engine_direction_template(name, vehid)     \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,      \
[ set_offset_to(2),                                \
  (prev_vehicle_type_id() == vehid) ||             \
  (position_in_consist == 0) ])                    \
{ 1: name##_sprites_left;                          \
     name##_sprites_right;}                        \
switch (FEAT_TRAINS, SELF, name##_sprites_old,     \
  ((LOAD_TEMP(0) - count_veh_id(vehid) + 1) % 2))  \
{ 1: name##_sprites_2l;                            \
     name##_sprites_right;}                        \
switch (FEAT_TRAINS, SELF, name##_sprites_16,      \
[  set_offset_to(-16),                             \
  (prev_vehicle_type_id() == vehid) ])             \
{ 1: name##_sprites_old;                           \
     name##_sprites_right;}                        \
switch (FEAT_TRAINS, SELF, name##_sprites_14,      \
[  set_offset_to(-14),                             \
  (prev_vehicle_type_id() == vehid) ])             \
{ 1: name##_sprites_16;                            \
     name##_sprites_2l;}                           \
switch (FEAT_TRAINS, SELF, name##_sprites_12,      \
[  set_offset_to(-12),                             \
  (prev_vehicle_type_id() == vehid) ])             \
{ 1: name##_sprites_14;                            \
     name##_sprites_right;}                        \
switch (FEAT_TRAINS, SELF, name##_sprites_10,      \
[  set_offset_to(-10),                             \
  (prev_vehicle_type_id() == vehid) ])             \
{ 1: name##_sprites_12;                            \
     name##_sprites_2l;}                           \
switch (FEAT_TRAINS, SELF, name##_sprites_8,       \
[  set_offset_to(-8),                              \
  (prev_vehicle_type_id() == vehid) ])             \
{ 1: name##_sprites_10;                            \
     name##_sprites_right;}                        \
switch (FEAT_TRAINS, SELF, name##_sprites_6,       \
[  set_offset_to(-6),                              \
  (prev_vehicle_type_id() == vehid) ])             \
{ 1: name##_sprites_8;                             \
     name##_sprites_2l;}                           \
switch (FEAT_TRAINS, SELF, name##_sprites_4,       \
[  set_offset_to(-4),                              \
  (prev_vehicle_type_id() == vehid) ])             \
{ 1: name##_sprites_6;                             \
     name##_sprites_right;}                        \
switch (FEAT_TRAINS, SELF, name##_sprites_start,   \
[  set_offset_to(-2),                              \
  (prev_vehicle_type_id() == vehid) ])             \
{ 1: name##_sprites_4;                             \
     name##_sprites_2l; }                          \

// Выбор ориентации кабины секции для СМЕ (схема с 1 альтернативой)

#define engine_direction_template2(name, vehid1, vehid2)  \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,             \
[ set_offset_to(2),                                       \
  (prev_vehicle_type_id() == vehid1) ||                   \
  (prev_vehicle_type_id() == vehid2) ||                   \
  (position_in_consist == 0) ])                           \
{ 1: name##_sprites_left;                                 \
     name##_sprites_right;}                               \
switch (FEAT_TRAINS, SELF, name##_sprites_old,            \
  ((LOAD_TEMP(0) - count_veh_id(vehid1) -                 \
    count_veh_id(vehid2) + 1) % 2))                       \
{ 1: name##_sprites_2l;                                   \
     name##_sprites_right;}                               \
switch (FEAT_TRAINS, SELF, name##_sprites_16,             \
[  set_offset_to(-16),                                    \
  (prev_vehicle_type_id() == vehid1) ||                   \
  (prev_vehicle_type_id() == vehid2) ])                   \
{ 1: name##_sprites_old;                                  \
     name##_sprites_right;}                               \
switch (FEAT_TRAINS, SELF, name##_sprites_14,             \
[  set_offset_to(-14),                                    \
  (prev_vehicle_type_id() == vehid1) ||                   \
  (prev_vehicle_type_id() == vehid2) ])                   \
{ 1: name##_sprites_16;                                   \
     name##_sprites_2l;}                                  \
switch (FEAT_TRAINS, SELF, name##_sprites_12,             \
[  set_offset_to(-12),                                    \
  (prev_vehicle_type_id() == vehid1) ||                   \
  (prev_vehicle_type_id() == vehid2) ])                   \
{ 1: name##_sprites_14;                                   \
     name##_sprites_right;}                               \
switch (FEAT_TRAINS, SELF, name##_sprites_10,             \
[  set_offset_to(-10),                                    \
  (prev_vehicle_type_id() == vehid1) ||                   \
  (prev_vehicle_type_id() == vehid2) ])                   \
{ 1: name##_sprites_12;                                   \
     name##_sprites_2l;}                                  \
switch (FEAT_TRAINS, SELF, name##_sprites_8,              \
[  set_offset_to(-8),                                     \
  (prev_vehicle_type_id() == vehid1) ||                   \
  (prev_vehicle_type_id() == vehid2) ])                   \
{ 1: name##_sprites_10;                                   \
     name##_sprites_right;}                               \
switch (FEAT_TRAINS, SELF, name##_sprites_6,              \
[  set_offset_to(-6),                                     \
  (prev_vehicle_type_id() == vehid1) ||                   \
  (prev_vehicle_type_id() == vehid2) ])                   \
{ 1: name##_sprites_8;                                    \
     name##_sprites_2l;}                                  \
switch (FEAT_TRAINS, SELF, name##_sprites_4,              \
[  set_offset_to(-4),                                     \
  (prev_vehicle_type_id() == vehid1) ||                   \
  (prev_vehicle_type_id() == vehid2) ])                   \
{ 1: name##_sprites_6;                                    \
     name##_sprites_right;}                               \
switch (FEAT_TRAINS, SELF, name##_sprites_start,          \
[  set_offset_to(-2),                                     \
  (prev_vehicle_type_id() == vehid1) ||                   \
  (prev_vehicle_type_id() == vehid2) ])                   \
{ 1: name##_sprites_4;                                    \
     name##_sprites_2l; }                                 \

// Выбор ориентации кабины секции для СМЕ (схема без альтернатив и средней секцией)

#define engine_direction_template2m(name, vehid, vehmid)  \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,             \
[ set_offset_to(2),                                       \
  (prev_vehicle_type_id() == vehid) ||                    \
  (position_in_consist == 0) ])                           \
{ 1: name##_sprites_left;                                 \
     name##_sprites_right;}                               \
switch (FEAT_TRAINS, SELF, name##_sprites_old,            \
  ((LOAD_TEMP(0) - count_veh_id(vehid) -                  \
    count_veh_id(vehmid) + 1) % 2))                       \
{ 1: name##_sprites_2l;                                   \
     name##_sprites_right;}                               \
switch (FEAT_TRAINS, SELF, name##_sprites_16,             \
[  set_offset_to(-16),                                    \
  (prev_vehicle_type_id() == vehid) +                     \
  ((prev_vehicle_type_id() == vehmid) * 2) ])             \
{ 1: name##_sprites_old;                                  \
  2: name##_sprites_2l;                                   \
     name##_sprites_right;}                               \
switch (FEAT_TRAINS, SELF, name##_sprites_14,             \
[  set_offset_to(-14),                                    \
  (prev_vehicle_type_id() == vehid) +                     \
  ((prev_vehicle_type_id() == vehmid) * 2) ])             \
{ 1: name##_sprites_16;                                   \
  2: name##_sprites_right;                                \
     name##_sprites_2l;}                                  \
switch (FEAT_TRAINS, SELF, name##_sprites_12,             \
[  set_offset_to(-12),                                    \
  (prev_vehicle_type_id() == vehid) +                     \
  ((prev_vehicle_type_id() == vehmid) * 2) ])             \
{ 1: name##_sprites_14;                                   \
  2: name##_sprites_2l;                                   \
     name##_sprites_right;}                               \
switch (FEAT_TRAINS, SELF, name##_sprites_10,             \
[  set_offset_to(-10),                                    \
  (prev_vehicle_type_id() == vehid) +                     \
  ((prev_vehicle_type_id() == vehmid) * 2) ])             \
{ 1: name##_sprites_12;                                   \
  2: name##_sprites_right;                                \
     name##_sprites_2l;}                                  \
switch (FEAT_TRAINS, SELF, name##_sprites_8,              \
[  set_offset_to(-8),                                     \
  (prev_vehicle_type_id() == vehid) +                     \
  ((prev_vehicle_type_id() == vehmid) * 2) ])             \
{ 1: name##_sprites_10;                                   \
  2: name##_sprites_2l;                                   \
     name##_sprites_right;}                               \
switch (FEAT_TRAINS, SELF, name##_sprites_6,              \
[  set_offset_to(-6),                                     \
  (prev_vehicle_type_id() == vehid) +                     \
  ((prev_vehicle_type_id() == vehmid) * 2) ])             \
{ 1: name##_sprites_8;                                    \
  2: name##_sprites_right;                                \
     name##_sprites_2l;}                                  \
switch (FEAT_TRAINS, SELF, name##_sprites_4,              \
[  set_offset_to(-4),                                     \
  (prev_vehicle_type_id() == vehid) +                     \
  ((prev_vehicle_type_id() == vehmid) * 2) ])             \
{ 1: name##_sprites_6;                                    \
  2: name##_sprites_2l;                                   \
     name##_sprites_right;}                               \
switch (FEAT_TRAINS, SELF, name##_sprites_2,              \
[  set_offset_to(-2),                                     \
  (prev_vehicle_type_id() == vehid) +                     \
  ((prev_vehicle_type_id() == vehmid) * 2) ])             \
{ 1: name##_sprites_4;                                    \
  2: name##_sprites_right;                                \
     name##_sprites_2l; }                                 \
switch (FEAT_TRAINS, SELF, name##_sprites_ml,             \
[  set_offset_to(2),                                      \
  (prev_vehicle_type_id() == vehmid) ])                   \
{ 1: name##_sprites_left;                                 \
     name##_sprites_2; }                                  \
switch (FEAT_TRAINS, SELF, name##_sprites_start,          \
[  set_offset_to(-2),                                     \
  (prev_vehicle_type_id() == vehmid) ])                   \
{ 1: name##_sprites_right;                                \
     name##_sprites_ml; }                                 \

// Выбор ориентации кабины секции для СМЕ (схема с 2 альтернативами)

#define engine_direction_template3(name, vehid1, vehid2, vehid3)  \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,                     \
[ set_offset_to(2),                                               \
  (prev_vehicle_type_id() == vehid1) ||                           \
  (prev_vehicle_type_id() == vehid2) ||                           \
  (prev_vehicle_type_id() == vehid3) ||                           \
  (position_in_consist == 0) ])                                   \
{ 1: name##_sprites_left;                                         \
     name##_sprites_right;}                                       \
switch (FEAT_TRAINS, SELF, name##_sprites_old,                    \
  ((LOAD_TEMP(0) - count_veh_id(vehid1) -                         \
    count_veh_id(vehid2) - count_veh_id(vehid3) + 1) % 2))        \
{ 1: name##_sprites_2l;                                           \
     name##_sprites_right;}                                       \
switch (FEAT_TRAINS, SELF, name##_sprites_16,                     \
[  set_offset_to(-16),                                            \
  (prev_vehicle_type_id() == vehid1) ||                           \
  (prev_vehicle_type_id() == vehid2) ||                           \
  (prev_vehicle_type_id() == vehid3) ])                           \
{ 1: name##_sprites_old;                                          \
     name##_sprites_right;}                                       \
switch (FEAT_TRAINS, SELF, name##_sprites_14,                     \
[  set_offset_to(-14),                                            \
  (prev_vehicle_type_id() == vehid1) ||                           \
  (prev_vehicle_type_id() == vehid2) ||                           \
  (prev_vehicle_type_id() == vehid3) ])                           \
{ 1: name##_sprites_16;                                           \
     name##_sprites_2l;}                                          \
switch (FEAT_TRAINS, SELF, name##_sprites_12,                     \
[  set_offset_to(-12),                                            \
  (prev_vehicle_type_id() == vehid1) ||                           \
  (prev_vehicle_type_id() == vehid2) ||                           \
  (prev_vehicle_type_id() == vehid3) ])                           \
{ 1: name##_sprites_14;                                           \
     name##_sprites_right;}                                       \
switch (FEAT_TRAINS, SELF, name##_sprites_10,                     \
[  set_offset_to(-10),                                            \
  (prev_vehicle_type_id() == vehid1) ||                           \
  (prev_vehicle_type_id() == vehid2) ||                           \
  (prev_vehicle_type_id() == vehid3) ])                           \
{ 1: name##_sprites_12;                                           \
     name##_sprites_2l;}                                          \
switch (FEAT_TRAINS, SELF, name##_sprites_8,                      \
[  set_offset_to(-8),                                             \
  (prev_vehicle_type_id() == vehid1) ||                           \
  (prev_vehicle_type_id() == vehid2) ||                           \
  (prev_vehicle_type_id() == vehid3) ])                           \
{ 1: name##_sprites_10;                                           \
     name##_sprites_right;}                                       \
switch (FEAT_TRAINS, SELF, name##_sprites_6,                      \
[  set_offset_to(-6),                                             \
  (prev_vehicle_type_id() == vehid1) ||                           \
  (prev_vehicle_type_id() == vehid2) ||                           \
  (prev_vehicle_type_id() == vehid3) ])                           \
{ 1: name##_sprites_8;                                            \
     name##_sprites_2l;}                                          \
switch (FEAT_TRAINS, SELF, name##_sprites_4,                      \
[  set_offset_to(-4),                                             \
  (prev_vehicle_type_id() == vehid1) ||                           \
  (prev_vehicle_type_id() == vehid2) ||                           \
  (prev_vehicle_type_id() == vehid3) ])                           \
{ 1: name##_sprites_6;                                            \
     name##_sprites_right;}                                       \
switch (FEAT_TRAINS, SELF, name##_sprites_start,                  \
[  set_offset_to(-2),                                             \
  (prev_vehicle_type_id() == vehid1) ||                           \
  (prev_vehicle_type_id() == vehid2) ||                           \
  (prev_vehicle_type_id() == vehid3) ])                           \
{ 1: name##_sprites_4;                                            \
     name##_sprites_2l; }                                         \

// Выбор ориентации кабины секции для СМЕ (схема с 1 альтернативой и средней секцией)

#define engine_direction_template3m(name, vehid1, vehid2, vehmid)  \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,                      \
[ set_offset_to(2),                                                \
  (prev_vehicle_type_id() == vehid1) ||                            \
  (prev_vehicle_type_id() == vehid2) ||                            \
  (position_in_consist == 0) ])                                    \
{ 1: name##_sprites_left;                                          \
     name##_sprites_right;}                                        \
switch (FEAT_TRAINS, SELF, name##_sprites_old,                     \
  ((LOAD_TEMP(0) - count_veh_id(vehid1) -                          \
    count_veh_id(vehid2) - count_veh_id(vehmid) + 1) % 2))         \
{ 1: name##_sprites_2l;                                            \
     name##_sprites_right;}                                        \
switch (FEAT_TRAINS, SELF, name##_sprites_16,                      \
[  set_offset_to(-16),                                             \
  ((prev_vehicle_type_id() == vehid1) ||                           \
   (prev_vehicle_type_id() == vehid2)) +                           \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                      \
{ 1: name##_sprites_old;                                           \
  2: name##_sprites_2l;                                            \
     name##_sprites_right;}                                        \
switch (FEAT_TRAINS, SELF, name##_sprites_14,                      \
[  set_offset_to(-14),                                             \
  ((prev_vehicle_type_id() == vehid1) ||                           \
   (prev_vehicle_type_id() == vehid2)) +                           \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                      \
{ 1: name##_sprites_16;                                            \
  2: name##_sprites_right;                                         \
     name##_sprites_2l;}                                           \
switch (FEAT_TRAINS, SELF, name##_sprites_12,                      \
[  set_offset_to(-12),                                             \
  ((prev_vehicle_type_id() == vehid1) ||                           \
   (prev_vehicle_type_id() == vehid2)) +                           \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                      \
{ 1: name##_sprites_14;                                            \
  2: name##_sprites_2l;                                            \
     name##_sprites_right;}                                        \
switch (FEAT_TRAINS, SELF, name##_sprites_10,                      \
[  set_offset_to(-10),                                             \
  ((prev_vehicle_type_id() == vehid1) ||                           \
   (prev_vehicle_type_id() == vehid2)) +                           \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                      \
{ 1: name##_sprites_12;                                            \
  2: name##_sprites_right;                                         \
     name##_sprites_2l;}                                           \
switch (FEAT_TRAINS, SELF, name##_sprites_8,                       \
[  set_offset_to(-8),                                              \
  ((prev_vehicle_type_id() == vehid1) ||                           \
   (prev_vehicle_type_id() == vehid2)) +                           \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                      \
{ 1: name##_sprites_10;                                            \
  2: name##_sprites_2l;                                            \
     name##_sprites_right;}                                        \
switch (FEAT_TRAINS, SELF, name##_sprites_6,                       \
[  set_offset_to(-6),                                              \
  ((prev_vehicle_type_id() == vehid1) ||                           \
   (prev_vehicle_type_id() == vehid2)) +                           \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                      \
{ 1: name##_sprites_8;                                             \
  2: name##_sprites_right;                                         \
     name##_sprites_2l;}                                           \
switch (FEAT_TRAINS, SELF, name##_sprites_4,                       \
[  set_offset_to(-4),                                              \
  ((prev_vehicle_type_id() == vehid1) ||                           \
   (prev_vehicle_type_id() == vehid2)) +                           \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                      \
{ 1: name##_sprites_6;                                             \
  2: name##_sprites_2l;                                            \
     name##_sprites_right;}                                        \
switch (FEAT_TRAINS, SELF, name##_sprites_2,                       \
[  set_offset_to(-2),                                              \
  ((prev_vehicle_type_id() == vehid1) ||                           \
   (prev_vehicle_type_id() == vehid2)) +                           \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                      \
{ 1: name##_sprites_4;                                             \
  2: name##_sprites_right;                                         \
     name##_sprites_2l; }                                          \
switch (FEAT_TRAINS, SELF, name##_sprites_ml,                      \
[  set_offset_to(2),                                               \
  (prev_vehicle_type_id() == vehmid) ])                            \
{ 1: name##_sprites_left;                                          \
     name##_sprites_2; }                                           \
switch (FEAT_TRAINS, SELF, name##_sprites_start,                   \
[  set_offset_to(-2),                                              \
  (prev_vehicle_type_id() == vehmid) ])                            \
{ 1: name##_sprites_right;                                         \
     name##_sprites_ml; }                                          \

// Выбор ориентации кабины секции для СМЕ (схема без альтернатив и 2-я средними секциями)

#define engine_direction_template3m2(name, vehid, vehmid1, vehmid2)  \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,                        \
[ set_offset_to(2),                                                  \
  (prev_vehicle_type_id() == vehid) ||                               \
  (position_in_consist == 0) ])                                      \
{ 1: name##_sprites_left;                                            \
     name##_sprites_right;}                                          \
switch (FEAT_TRAINS, SELF, name##_sprites_old,                       \
  ((LOAD_TEMP(0) - count_veh_id(vehid) -                             \
    count_veh_id(vehmid1) -                                          \
    count_veh_id(vehmid2) + 1) % 2))                                 \
{ 1: name##_sprites_2l;                                              \
     name##_sprites_right;}                                          \
switch (FEAT_TRAINS, SELF, name##_sprites_16,                        \
[  set_offset_to(-16),                                               \
  (prev_vehicle_type_id() == vehid) +                                \
  (((prev_vehicle_type_id() == vehmid1) ||                           \
    (prev_vehicle_type_id() == vehmid2)) * 2) ])                     \
{ 1: name##_sprites_old;                                             \
  2: name##_sprites_2l;                                              \
     name##_sprites_right;}                                          \
switch (FEAT_TRAINS, SELF, name##_sprites_14,                        \
[  set_offset_to(-14),                                               \
  (prev_vehicle_type_id() == vehid) +                                \
  (((prev_vehicle_type_id() == vehmid1) ||                           \
   (prev_vehicle_type_id() == vehmid2)) * 2) ])                      \
{ 1: name##_sprites_16;                                              \
  2: name##_sprites_right;                                           \
     name##_sprites_2l;}                                             \
switch (FEAT_TRAINS, SELF, name##_sprites_12,                        \
[  set_offset_to(-12),                                               \
  (prev_vehicle_type_id() == vehid) +                                \
  (((prev_vehicle_type_id() == vehmid1) ||                           \
   (prev_vehicle_type_id() == vehmid2)) * 2) ])                      \
{ 1: name##_sprites_14;                                              \
  2: name##_sprites_2l;                                              \
     name##_sprites_right;}                                          \
switch (FEAT_TRAINS, SELF, name##_sprites_10,                        \
[  set_offset_to(-10),                                               \
  (prev_vehicle_type_id() == vehid) +                                \
  (((prev_vehicle_type_id() == vehmid1) ||                           \
   (prev_vehicle_type_id() == vehmid2)) * 2) ])                      \
{ 1: name##_sprites_12;                                              \
  2: name##_sprites_right;                                           \
     name##_sprites_2l;}                                             \
switch (FEAT_TRAINS, SELF, name##_sprites_8,                         \
[  set_offset_to(-8),                                                \
  (prev_vehicle_type_id() == vehid) +                                \
  (((prev_vehicle_type_id() == vehmid1) ||                           \
   (prev_vehicle_type_id() == vehmid2)) * 2) ])                      \
{ 1: name##_sprites_10;                                              \
  2: name##_sprites_2l;                                              \
     name##_sprites_right;}                                          \
switch (FEAT_TRAINS, SELF, name##_sprites_6,                         \
[  set_offset_to(-6),                                                \
  (prev_vehicle_type_id() == vehid) +                                \
  (((prev_vehicle_type_id() == vehmid1) ||                           \
   (prev_vehicle_type_id() == vehmid2)) * 2) ])                      \
{ 1: name##_sprites_8;                                               \
  2: name##_sprites_right;                                           \
     name##_sprites_2l;}                                             \
switch (FEAT_TRAINS, SELF, name##_sprites_4,                         \
[  set_offset_to(-4),                                                \
  (prev_vehicle_type_id() == vehid) +                                \
  (((prev_vehicle_type_id() == vehmid1) ||                           \
   (prev_vehicle_type_id() == vehmid2)) * 2) ])                      \
{ 1: name##_sprites_6;                                               \
  2: name##_sprites_2l;                                              \
     name##_sprites_right;}                                          \
switch (FEAT_TRAINS, SELF, name##_sprites_2,                         \
[  set_offset_to(-2),                                                \
  ((prev_vehicle_type_id() == vehid))  +                             \
  (((prev_vehicle_type_id() == vehmid1) ||                           \
   (prev_vehicle_type_id() == vehmid2)) * 2) ])                      \
{ 1: name##_sprites_4;                                               \
  2: name##_sprites_right;                                           \
     name##_sprites_2l; }                                            \
switch (FEAT_TRAINS, SELF, name##_sprites_ml,                        \
[  set_offset_to(2),                                                 \
  ((prev_vehicle_type_id() == vehmid1) ||                            \
   (prev_vehicle_type_id() == vehmid2)) ])                           \
{ 1: name##_sprites_left;                                            \
     name##_sprites_2; }                                             \
switch (FEAT_TRAINS, SELF, name##_sprites_start,                     \
[  set_offset_to(-2),                                                \
  ((prev_vehicle_type_id() == vehmid1) ||                            \
   (prev_vehicle_type_id() == vehmid2)) ])                           \
{ 1: name##_sprites_right;                                           \
     name##_sprites_ml; }                                            \

// Выбор ориентации кабины секции для СМЕ (схема с 3 альтернативами)

#define engine_direction_template4(name, vehid1, vehid2, vehid3, vehid4)  \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,                             \
[ set_offset_to(2),                                                       \
  (prev_vehicle_type_id() == vehid1) ||                                   \
  (prev_vehicle_type_id() == vehid2) ||                                   \
  (prev_vehicle_type_id() == vehid3) ||                                   \
  (prev_vehicle_type_id() == vehid4) ||                                   \
  (position_in_consist == 0) ])                                           \
{ 1: name##_sprites_left;                                                 \
     name##_sprites_right;}                                               \
switch (FEAT_TRAINS, SELF, name##_sprites_old,                            \
  ((LOAD_TEMP(0) - count_veh_id(vehid1) -                                 \
    count_veh_id(vehid2) - count_veh_id(vehid3) -                         \
    count_veh_id(vehid4) + 1) % 2))                                       \
{ 1: name##_sprites_2l;                                                   \
     name##_sprites_right;}                                               \
switch (FEAT_TRAINS, SELF, name##_sprites_16,                             \
[  set_offset_to(-16),                                                    \
  (prev_vehicle_type_id() == vehid1) ||                                   \
  (prev_vehicle_type_id() == vehid2) ||                                   \
  (prev_vehicle_type_id() == vehid3) ||                                   \
  (prev_vehicle_type_id() == vehid4) ])                                   \
{ 1: name##_sprites_old;                                                  \
     name##_sprites_right;}                                               \
switch (FEAT_TRAINS, SELF, name##_sprites_14,                             \
[  set_offset_to(-14),                                                    \
  (prev_vehicle_type_id() == vehid1) ||                                   \
  (prev_vehicle_type_id() == vehid2) ||                                   \
  (prev_vehicle_type_id() == vehid3) ||                                   \
  (prev_vehicle_type_id() == vehid4) ])                                   \
{ 1: name##_sprites_16;                                                   \
     name##_sprites_2l;}                                                  \
switch (FEAT_TRAINS, SELF, name##_sprites_12,                             \
[  set_offset_to(-12),                                                    \
  (prev_vehicle_type_id() == vehid1) ||                                   \
  (prev_vehicle_type_id() == vehid2) ||                                   \
  (prev_vehicle_type_id() == vehid3) ||                                   \
  (prev_vehicle_type_id() == vehid4) ])                                   \
{ 1: name##_sprites_14;                                                   \
     name##_sprites_right;}                                               \
switch (FEAT_TRAINS, SELF, name##_sprites_10,                             \
[  set_offset_to(-10),                                                    \
  (prev_vehicle_type_id() == vehid1) ||                                   \
  (prev_vehicle_type_id() == vehid2) ||                                   \
  (prev_vehicle_type_id() == vehid3) ||                                   \
  (prev_vehicle_type_id() == vehid4) ])                                   \
{ 1: name##_sprites_12;                                                   \
     name##_sprites_2l;}                                                  \
switch (FEAT_TRAINS, SELF, name##_sprites_8,                              \
[  set_offset_to(-8),                                                     \
  (prev_vehicle_type_id() == vehid1) ||                                   \
  (prev_vehicle_type_id() == vehid2) ||                                   \
  (prev_vehicle_type_id() == vehid3) ||                                   \
  (prev_vehicle_type_id() == vehid4) ])                                   \
{ 1: name##_sprites_10;                                                   \
     name##_sprites_right;}                                               \
switch (FEAT_TRAINS, SELF, name##_sprites_6,                              \
[  set_offset_to(-6),                                                     \
  (prev_vehicle_type_id() == vehid1) ||                                   \
  (prev_vehicle_type_id() == vehid2) ||                                   \
  (prev_vehicle_type_id() == vehid3) ||                                   \
  (prev_vehicle_type_id() == vehid4) ])                                   \
{ 1: name##_sprites_8;                                                    \
     name##_sprites_2l;}                                                  \
switch (FEAT_TRAINS, SELF, name##_sprites_4,                              \
[  set_offset_to(-4),                                                     \
  (prev_vehicle_type_id() == vehid1) ||                                   \
  (prev_vehicle_type_id() == vehid2) ||                                   \
  (prev_vehicle_type_id() == vehid3) ||                                   \
  (prev_vehicle_type_id() == vehid4) ])                                   \
{ 1: name##_sprites_6;                                                    \
     name##_sprites_right;}                                               \
switch (FEAT_TRAINS, SELF, name##_sprites_start,                          \
[  set_offset_to(-2),                                                     \
  (prev_vehicle_type_id() == vehid1) ||                                   \
  (prev_vehicle_type_id() == vehid2) ||                                   \
  (prev_vehicle_type_id() == vehid3) ||                                   \
  (prev_vehicle_type_id() == vehid4) ])                                   \
{ 1: name##_sprites_4;                                                    \
     name##_sprites_2l; }                                                 \

// Выбор ориентации кабины секции для СМЕ (схема с 2 альтернативами и средней секцией)

#define engine_direction_template4m(name, vehid1, vehid2, vehid3, vehmid)  \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,                              \
[ set_offset_to(2),                                                        \
  (prev_vehicle_type_id() == vehid1) ||                                    \
  (prev_vehicle_type_id() == vehid2) ||                                    \
  (prev_vehicle_type_id() == vehid3) ||                                    \
  (position_in_consist == 0) ])                                            \
{ 1: name##_sprites_left;                                                  \
     name##_sprites_right;}                                                \
switch (FEAT_TRAINS, SELF, name##_sprites_old,                             \
  ((LOAD_TEMP(0) - count_veh_id(vehid1) - count_veh_id(vehid2) -           \
    count_veh_id(vehid3) - count_veh_id(vehmid) + 1) % 2))                 \
{ 1: name##_sprites_2l;                                                    \
     name##_sprites_right;}                                                \
switch (FEAT_TRAINS, SELF, name##_sprites_16,                              \
[  set_offset_to(-16),                                                     \
  ((prev_vehicle_type_id() == vehid1) ||                                   \
   (prev_vehicle_type_id() == vehid2) ||                                   \
   (prev_vehicle_type_id() == vehid3)) +                                   \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                              \
{ 1: name##_sprites_old;                                                   \
  2: name##_sprites_2l;                                                    \
     name##_sprites_right;}                                                \
switch (FEAT_TRAINS, SELF, name##_sprites_14,                              \
[  set_offset_to(-14),                                                     \
  ((prev_vehicle_type_id() == vehid1) ||                                   \
   (prev_vehicle_type_id() == vehid2) ||                                   \
   (prev_vehicle_type_id() == vehid3)) +                                   \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                              \
{ 1: name##_sprites_16;                                                    \
  2: name##_sprites_right;                                                 \
     name##_sprites_2l;}                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_12,                              \
[  set_offset_to(-12),                                                     \
  ((prev_vehicle_type_id() == vehid1) ||                                   \
   (prev_vehicle_type_id() == vehid2) ||                                   \
   (prev_vehicle_type_id() == vehid3)) +                                   \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                              \
{ 1: name##_sprites_14;                                                    \
  2: name##_sprites_2l;                                                    \
     name##_sprites_right;}                                                \
switch (FEAT_TRAINS, SELF, name##_sprites_10,                              \
[  set_offset_to(-10),                                                     \
  ((prev_vehicle_type_id() == vehid1) ||                                   \
   (prev_vehicle_type_id() == vehid2) ||                                   \
   (prev_vehicle_type_id() == vehid3)) +                                   \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                              \
{ 1: name##_sprites_12;                                                    \
  2: name##_sprites_right;                                                 \
     name##_sprites_2l;}                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_8,                               \
[  set_offset_to(-8),                                                      \
  ((prev_vehicle_type_id() == vehid1) ||                                   \
   (prev_vehicle_type_id() == vehid2) ||                                   \
   (prev_vehicle_type_id() == vehid3)) +                                   \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                              \
{ 1: name##_sprites_10;                                                    \
  2: name##_sprites_2l;                                                    \
     name##_sprites_right;}                                                \
switch (FEAT_TRAINS, SELF, name##_sprites_6,                               \
[  set_offset_to(-6),                                                      \
  ((prev_vehicle_type_id() == vehid1) ||                                   \
   (prev_vehicle_type_id() == vehid2) ||                                   \
   (prev_vehicle_type_id() == vehid3)) +                                   \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                              \
{ 1: name##_sprites_8;                                                     \
  2: name##_sprites_right;                                                 \
     name##_sprites_2l;}                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_4,                               \
[  set_offset_to(-4),                                                      \
  ((prev_vehicle_type_id() == vehid1) ||                                   \
   (prev_vehicle_type_id() == vehid2) ||                                   \
   (prev_vehicle_type_id() == vehid3)) +                                   \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                              \
{ 1: name##_sprites_6;                                                     \
  2: name##_sprites_2l;                                                    \
     name##_sprites_right;}                                                \
switch (FEAT_TRAINS, SELF, name##_sprites_2,                               \
[  set_offset_to(-2),                                                      \
  ((prev_vehicle_type_id() == vehid1) ||                                   \
   (prev_vehicle_type_id() == vehid2) ||                                   \
   (prev_vehicle_type_id() == vehid3)) +                                   \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                              \
{ 1: name##_sprites_4;                                                     \
  2: name##_sprites_right;                                                 \
     name##_sprites_2l; }                                                  \
switch (FEAT_TRAINS, SELF, name##_sprites_ml,                              \
[  set_offset_to(2),                                                       \
  (prev_vehicle_type_id() == vehmid) ])                                    \
{ 1: name##_sprites_left;                                                  \
     name##_sprites_2; }                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_start,                           \
[  set_offset_to(-2),                                                      \
  (prev_vehicle_type_id() == vehmid) ])                                    \
{ 1: name##_sprites_right;                                                 \
     name##_sprites_ml; }                                                  \

// Выбор ориентации кабины секции для СМЕ (схема с 3 альтернативами и средней секцией)

#define engine_direction_template5m(name, vehid1, vehid2, vehid3, vehid4, vehmid)  \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,                                      \
[ set_offset_to(2),                                                                \
  (prev_vehicle_type_id() == vehid1) ||                                            \
  (prev_vehicle_type_id() == vehid2) ||                                            \
  (prev_vehicle_type_id() == vehid3) ||                                            \
  (prev_vehicle_type_id() == vehid4) ||                                            \
  (position_in_consist == 0) ])                                                    \
{ 1: name##_sprites_left;                                                          \
     name##_sprites_right;}                                                        \
switch (FEAT_TRAINS, SELF, name##_sprites_old,                                     \
  ((LOAD_TEMP(0) - count_veh_id(vehid1) - count_veh_id(vehid2) -                   \
    count_veh_id(vehid3) - count_veh_id(vehmid) + 1) % 2))                         \
{ 1: name##_sprites_2l;                                                            \
     name##_sprites_right;}                                                        \
switch (FEAT_TRAINS, SELF, name##_sprites_16,                                      \
[  set_offset_to(-16),                                                             \
  ((prev_vehicle_type_id() == vehid1) ||                                           \
   (prev_vehicle_type_id() == vehid2) ||                                           \
   (prev_vehicle_type_id() == vehid3) ||                                           \
   (prev_vehicle_type_id() == vehid4)) +                                           \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                                      \
{ 1: name##_sprites_old;                                                           \
  2: name##_sprites_2l;                                                            \
     name##_sprites_right;}                                                        \
switch (FEAT_TRAINS, SELF, name##_sprites_14,                                      \
[  set_offset_to(-14),                                                             \
  ((prev_vehicle_type_id() == vehid1) ||                                           \
   (prev_vehicle_type_id() == vehid2) ||                                           \
   (prev_vehicle_type_id() == vehid3) ||                                           \
   (prev_vehicle_type_id() == vehid4)) +                                           \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                                      \
{ 1: name##_sprites_16;                                                            \
  2: name##_sprites_right;                                                         \
     name##_sprites_2l;}                                                           \
switch (FEAT_TRAINS, SELF, name##_sprites_12,                                      \
[  set_offset_to(-12),                                                             \
  ((prev_vehicle_type_id() == vehid1) ||                                           \
   (prev_vehicle_type_id() == vehid2) ||                                           \
   (prev_vehicle_type_id() == vehid3) ||                                           \
   (prev_vehicle_type_id() == vehid4)) +                                           \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                                      \
{ 1: name##_sprites_14;                                                            \
  2: name##_sprites_2l;                                                            \
     name##_sprites_right;}                                                        \
switch (FEAT_TRAINS, SELF, name##_sprites_10,                                      \
[  set_offset_to(-10),                                                             \
  ((prev_vehicle_type_id() == vehid1) ||                                           \
   (prev_vehicle_type_id() == vehid2) ||                                           \
   (prev_vehicle_type_id() == vehid3) ||                                           \
   (prev_vehicle_type_id() == vehid4)) +                                           \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                                      \
{ 1: name##_sprites_12;                                                            \
  2: name##_sprites_right;                                                         \
     name##_sprites_2l;}                                                           \
switch (FEAT_TRAINS, SELF, name##_sprites_8,                                       \
[  set_offset_to(-8),                                                              \
  ((prev_vehicle_type_id() == vehid1) ||                                           \
   (prev_vehicle_type_id() == vehid2) ||                                           \
   (prev_vehicle_type_id() == vehid3) ||                                           \
   (prev_vehicle_type_id() == vehid4)) +                                           \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                                      \
{ 1: name##_sprites_10;                                                            \
  2: name##_sprites_2l;                                                            \
     name##_sprites_right;}                                                        \
switch (FEAT_TRAINS, SELF, name##_sprites_6,                                       \
[  set_offset_to(-6),                                                              \
  ((prev_vehicle_type_id() == vehid1) ||                                           \
   (prev_vehicle_type_id() == vehid2) ||                                           \
   (prev_vehicle_type_id() == vehid3) ||                                           \
   (prev_vehicle_type_id() == vehid4)) +                                           \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                                      \
{ 1: name##_sprites_8;                                                             \
  2: name##_sprites_right;                                                         \
     name##_sprites_2l;}                                                           \
switch (FEAT_TRAINS, SELF, name##_sprites_4,                                       \
[  set_offset_to(-4),                                                              \
  ((prev_vehicle_type_id() == vehid1) ||                                           \
   (prev_vehicle_type_id() == vehid2) ||                                           \
   (prev_vehicle_type_id() == vehid3) ||                                           \
   (prev_vehicle_type_id() == vehid4)) +                                           \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                                      \
{ 1: name##_sprites_6;                                                             \
  2: name##_sprites_2l;                                                            \
     name##_sprites_right;}                                                        \
switch (FEAT_TRAINS, SELF, name##_sprites_2,                                       \
[  set_offset_to(-2),                                                              \
  ((prev_vehicle_type_id() == vehid1) ||                                           \
   (prev_vehicle_type_id() == vehid2) ||                                           \
   (prev_vehicle_type_id() == vehid3) ||                                           \
   (prev_vehicle_type_id() == vehid4)) +                                           \
  ((prev_vehicle_type_id() == vehmid) * 2) ])                                      \
{ 1: name##_sprites_4;                                                             \
  2: name##_sprites_right;                                                         \
     name##_sprites_2l; }                                                          \
switch (FEAT_TRAINS, SELF, name##_sprites_ml,                                      \
[  set_offset_to(2),                                                               \
  (prev_vehicle_type_id() == vehmid) ])                                            \
{ 1: name##_sprites_left;                                                          \
     name##_sprites_2; }                                                           \
switch (FEAT_TRAINS, SELF, name##_sprites_start,                                   \
[  set_offset_to(-2),                                                              \
  (prev_vehicle_type_id() == vehmid) ])                                            \
{ 1: name##_sprites_right;                                                         \
     name##_sprites_ml; }                                                          \

// Выбор ориентации кабины секции для СМЕ (схема с 1 альтернативой и 2-я средними секциями)

#define engine_direction_template4m2(name, vehid1, vehid2, vehmid1, vehmid2)  \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,                                 \
[ set_offset_to(2),                                                           \
  (prev_vehicle_type_id() == vehid1) ||                                       \
  (prev_vehicle_type_id() == vehid2) ||                                       \
  (position_in_consist == 0) ])                                               \
{ 1: name##_sprites_left;                                                     \
     name##_sprites_right;}                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_old,                                \
  ((LOAD_TEMP(0) - count_veh_id(vehid1) -                                     \
    count_veh_id(vehid2) -                                                    \
    count_veh_id(vehmid1) -                                                   \
    count_veh_id(vehmid2) + 1) % 2))                                          \
{ 1: name##_sprites_2l;                                                       \
     name##_sprites_right;}                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_16,                                 \
[  set_offset_to(-16),                                                        \
  ((prev_vehicle_type_id() == vehid1) ||                                      \
   (prev_vehicle_type_id() == vehid2)) +                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                    \
    (prev_vehicle_type_id() == vehmid2)) * 2) ])                              \
{ 1: name##_sprites_old;                                                      \
  2: name##_sprites_2l;                                                       \
     name##_sprites_right;}                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_14,                                 \
[  set_offset_to(-14),                                                        \
  ((prev_vehicle_type_id() == vehid1) ||                                      \
   (prev_vehicle_type_id() == vehid2)) +                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                    \
    (prev_vehicle_type_id() == vehmid2)) * 2) ])                              \
{ 1: name##_sprites_16;                                                       \
  2: name##_sprites_right;                                                    \
     name##_sprites_2l;}                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_12,                                 \
[  set_offset_to(-12),                                                        \
  ((prev_vehicle_type_id() == vehid1) ||                                      \
   (prev_vehicle_type_id() == vehid2)) +                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                    \
    (prev_vehicle_type_id() == vehmid2)) * 2) ])                              \
{ 1: name##_sprites_14;                                                       \
  2: name##_sprites_2l;                                                       \
     name##_sprites_right;}                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_10,                                 \
[  set_offset_to(-10),                                                        \
  ((prev_vehicle_type_id() == vehid1) ||                                      \
   (prev_vehicle_type_id() == vehid2)) +                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                    \
    (prev_vehicle_type_id() == vehmid2)) * 2) ])                              \
{ 1: name##_sprites_12;                                                       \
  2: name##_sprites_right;                                                    \
     name##_sprites_2l;}                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_8,                                  \
[  set_offset_to(-8),                                                         \
  ((prev_vehicle_type_id() == vehid1) ||                                      \
   (prev_vehicle_type_id() == vehid2)) +                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                    \
    (prev_vehicle_type_id() == vehmid2)) * 2) ])                              \
{ 1: name##_sprites_10;                                                       \
  2: name##_sprites_2l;                                                       \
     name##_sprites_right;}                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_6,                                  \
[  set_offset_to(-6),                                                         \
  ((prev_vehicle_type_id() == vehid1) ||                                      \
   (prev_vehicle_type_id() == vehid2)) +                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                    \
    (prev_vehicle_type_id() == vehmid2)) * 2) ])                              \
{ 1: name##_sprites_8;                                                        \
  2: name##_sprites_right;                                                    \
     name##_sprites_2l;}                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_4,                                  \
[  set_offset_to(-4),                                                         \
  ((prev_vehicle_type_id() == vehid1) ||                                      \
   (prev_vehicle_type_id() == vehid2)) +                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                    \
    (prev_vehicle_type_id() == vehmid2)) * 2) ])                              \
{ 1: name##_sprites_6;                                                        \
  2: name##_sprites_2l;                                                       \
     name##_sprites_right;}                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_2,                                  \
[  set_offset_to(-2),                                                         \
  ((prev_vehicle_type_id() == vehid1) ||                                      \
   (prev_vehicle_type_id() == vehid2)) +                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                    \
    (prev_vehicle_type_id() == vehmid2)) * 2) ])                              \
{ 1: name##_sprites_4;                                                        \
  2: name##_sprites_right;                                                    \
     name##_sprites_2l; }                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_ml,                                 \
[  set_offset_to(2),                                                          \
  ((prev_vehicle_type_id() == vehmid1) ||                                     \
   (prev_vehicle_type_id() == vehmid2)) ])                                    \
{ 1: name##_sprites_left;                                                     \
     name##_sprites_2; }                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_start,                              \
[  set_offset_to(-2),                                                         \
  ((prev_vehicle_type_id() == vehmid1) ||                                     \
   (prev_vehicle_type_id() == vehmid2)) ])                                    \
{ 1: name##_sprites_right;                                                    \
     name##_sprites_ml; }                                                     \

// Выбор ориентации кабины секции для СМЕ (схема без альтернатив и 3-я средними секциями)

#define engine_direction_template4m3(name, vehid, vehmid1, vehmid2, vehmid3)  \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,                                 \
[ set_offset_to(2),                                                           \
  (prev_vehicle_type_id() == vehid) ||                                        \
  (position_in_consist == 0) ])                                               \
{ 1: name##_sprites_left;                                                     \
     name##_sprites_right;}                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_old,                                \
  ((LOAD_TEMP(0) - count_veh_id(vehid) -                                      \
    count_veh_id(vehmid1) -                                                   \
    count_veh_id(vehmid2) -                                                   \
    count_veh_id(vehmid3) + 1) % 2))                                          \
{ 1: name##_sprites_2l;                                                       \
     name##_sprites_right;}                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_16,                                 \
[  set_offset_to(-16),                                                        \
  (prev_vehicle_type_id() == vehid) +                                         \
  (((prev_vehicle_type_id() == vehmid1) ||                                    \
    (prev_vehicle_type_id() == vehmid2) ||                                    \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                              \
{ 1: name##_sprites_old;                                                      \
  2: name##_sprites_2l;                                                       \
     name##_sprites_right;}                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_14,                                 \
[  set_offset_to(-14),                                                        \
  (prev_vehicle_type_id() == vehid) +                                         \
  (((prev_vehicle_type_id() == vehmid1) ||                                    \
    (prev_vehicle_type_id() == vehmid2) ||                                    \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                              \
{ 1: name##_sprites_16;                                                       \
  2: name##_sprites_right;                                                    \
     name##_sprites_2l;}                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_12,                                 \
[  set_offset_to(-12),                                                        \
  (prev_vehicle_type_id() == vehid) +                                         \
  (((prev_vehicle_type_id() == vehmid1) ||                                    \
    (prev_vehicle_type_id() == vehmid2) ||                                    \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                              \
{ 1: name##_sprites_14;                                                       \
  2: name##_sprites_2l;                                                       \
     name##_sprites_right;}                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_10,                                 \
[  set_offset_to(-10),                                                        \
  (prev_vehicle_type_id() == vehid) +                                         \
  (((prev_vehicle_type_id() == vehmid1) ||                                    \
    (prev_vehicle_type_id() == vehmid2) ||                                    \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                              \
{ 1: name##_sprites_12;                                                       \
  2: name##_sprites_right;                                                    \
     name##_sprites_2l;}                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_8,                                  \
[  set_offset_to(-8),                                                         \
  (prev_vehicle_type_id() == vehid) +                                         \
  (((prev_vehicle_type_id() == vehmid1) ||                                    \
    (prev_vehicle_type_id() == vehmid2) ||                                    \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                              \
{ 1: name##_sprites_10;                                                       \
  2: name##_sprites_2l;                                                       \
     name##_sprites_right;}                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_6,                                  \
[  set_offset_to(-6),                                                         \
  (prev_vehicle_type_id() == vehid) +                                         \
  (((prev_vehicle_type_id() == vehmid1) ||                                    \
    (prev_vehicle_type_id() == vehmid2) ||                                    \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                              \
{ 1: name##_sprites_8;                                                        \
  2: name##_sprites_right;                                                    \
     name##_sprites_2l;}                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_4,                                  \
[  set_offset_to(-4),                                                         \
  (prev_vehicle_type_id() == vehid) +                                         \
  (((prev_vehicle_type_id() == vehmid1) ||                                    \
    (prev_vehicle_type_id() == vehmid2) ||                                    \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                              \
{ 1: name##_sprites_6;                                                        \
  2: name##_sprites_2l;                                                       \
     name##_sprites_right;}                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_2,                                  \
[  set_offset_to(-2),                                                         \
  ((prev_vehicle_type_id() == vehid))  +                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                    \
    (prev_vehicle_type_id() == vehmid2) ||                                    \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                              \
{ 1: name##_sprites_4;                                                        \
  2: name##_sprites_right;                                                    \
     name##_sprites_2l; }                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_ml,                                 \
[  set_offset_to(2),                                                          \
  ((prev_vehicle_type_id() == vehmid1) ||                                     \
   (prev_vehicle_type_id() == vehmid2) ||                                     \
   (prev_vehicle_type_id() == vehmid3)) ])                                    \
{ 1: name##_sprites_left;                                                     \
     name##_sprites_2; }                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_start,                              \
[  set_offset_to(-2),                                                         \
  ((prev_vehicle_type_id() == vehmid1) ||                                     \
   (prev_vehicle_type_id() == vehmid2) ||                                     \
   (prev_vehicle_type_id() == vehmid3)) ])                                    \
{ 1: name##_sprites_right;                                                    \
     name##_sprites_ml; }                                                     \

// Выбор ориентации кабины секции для СМЕ (схема с 1 альтернативой и 3-я средними секциями)

#define engine_direction_template5m3(name, vehid1, vehid2, vehmid1, vehmid2, vehmid3)  \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,                                          \
[ set_offset_to(2),                                                                    \
  (prev_vehicle_type_id() == vehid1) ||                                                \
  (prev_vehicle_type_id() == vehid2) ||                                                \
  (position_in_consist == 0) ])                                                        \
{ 1: name##_sprites_left;                                                              \
     name##_sprites_right;}                                                            \
switch (FEAT_TRAINS, SELF, name##_sprites_old,                                         \
  ((LOAD_TEMP(0) - count_veh_id(vehid1) -                                              \
    count_veh_id(vehid2) -                                                             \
    count_veh_id(vehmid1) -                                                            \
    count_veh_id(vehmid2) -                                                            \
    count_veh_id(vehmid3) + 1) % 2))                                                   \
{ 1: name##_sprites_2l;                                                                \
     name##_sprites_right;}                                                            \
switch (FEAT_TRAINS, SELF, name##_sprites_16,                                          \
[  set_offset_to(-16),                                                                 \
  ((prev_vehicle_type_id() == vehid1) ||                                               \
   (prev_vehicle_type_id() == vehid2)) +                                               \
  (((prev_vehicle_type_id() == vehmid1) ||                                             \
    (prev_vehicle_type_id() == vehmid2) ||                                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                                       \
{ 1: name##_sprites_old;                                                               \
  2: name##_sprites_2l;                                                                \
     name##_sprites_right;}                                                            \
switch (FEAT_TRAINS, SELF, name##_sprites_14,                                          \
[  set_offset_to(-14),                                                                 \
  ((prev_vehicle_type_id() == vehid1) ||                                               \
   (prev_vehicle_type_id() == vehid2)) +                                               \
  (((prev_vehicle_type_id() == vehmid1) ||                                             \
    (prev_vehicle_type_id() == vehmid2) ||                                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                                       \
{ 1: name##_sprites_16;                                                                \
  2: name##_sprites_right;                                                             \
     name##_sprites_2l;}                                                               \
switch (FEAT_TRAINS, SELF, name##_sprites_12,                                          \
[  set_offset_to(-12),                                                                 \
  ((prev_vehicle_type_id() == vehid1) ||                                               \
   (prev_vehicle_type_id() == vehid2)) +                                               \
  (((prev_vehicle_type_id() == vehmid1) ||                                             \
    (prev_vehicle_type_id() == vehmid2) ||                                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                                       \
{ 1: name##_sprites_14;                                                                \
  2: name##_sprites_2l;                                                                \
     name##_sprites_right;}                                                            \
switch (FEAT_TRAINS, SELF, name##_sprites_10,                                          \
[  set_offset_to(-10),                                                                 \
  ((prev_vehicle_type_id() == vehid1) ||                                               \
   (prev_vehicle_type_id() == vehid2)) +                                               \
  (((prev_vehicle_type_id() == vehmid1) ||                                             \
    (prev_vehicle_type_id() == vehmid2) ||                                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                                       \
{ 1: name##_sprites_12;                                                                \
  2: name##_sprites_right;                                                             \
     name##_sprites_2l;}                                                               \
switch (FEAT_TRAINS, SELF, name##_sprites_8,                                           \
[  set_offset_to(-8),                                                                  \
  ((prev_vehicle_type_id() == vehid1) ||                                               \
   (prev_vehicle_type_id() == vehid2)) +                                               \
  (((prev_vehicle_type_id() == vehmid1) ||                                             \
    (prev_vehicle_type_id() == vehmid2) ||                                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                                       \
{ 1: name##_sprites_10;                                                                \
  2: name##_sprites_2l;                                                                \
     name##_sprites_right;}                                                            \
switch (FEAT_TRAINS, SELF, name##_sprites_6,                                           \
[  set_offset_to(-6),                                                                  \
  ((prev_vehicle_type_id() == vehid1) ||                                               \
   (prev_vehicle_type_id() == vehid2)) +                                               \
  (((prev_vehicle_type_id() == vehmid1) ||                                             \
    (prev_vehicle_type_id() == vehmid2) ||                                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                                       \
{ 1: name##_sprites_8;                                                                 \
  2: name##_sprites_right;                                                             \
     name##_sprites_2l;}                                                               \
switch (FEAT_TRAINS, SELF, name##_sprites_4,                                           \
[  set_offset_to(-4),                                                                  \
  ((prev_vehicle_type_id() == vehid1) ||                                               \
   (prev_vehicle_type_id() == vehid2)) +                                               \
  (((prev_vehicle_type_id() == vehmid1) ||                                             \
    (prev_vehicle_type_id() == vehmid2) ||                                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                                       \
{ 1: name##_sprites_6;                                                                 \
  2: name##_sprites_2l;                                                                \
     name##_sprites_right;}                                                            \
switch (FEAT_TRAINS, SELF, name##_sprites_2,                                           \
[  set_offset_to(-2),                                                                  \
  ((prev_vehicle_type_id() == vehid1) ||                                               \
   (prev_vehicle_type_id() == vehid2)) +                                               \
  (((prev_vehicle_type_id() == vehmid1) ||                                             \
    (prev_vehicle_type_id() == vehmid2) ||                                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                                       \
{ 1: name##_sprites_4;                                                                 \
  2: name##_sprites_right;                                                             \
     name##_sprites_2l; }                                                              \
switch (FEAT_TRAINS, SELF, name##_sprites_ml,                                          \
[  set_offset_to(2),                                                                   \
  ((prev_vehicle_type_id() == vehmid1) ||                                              \
   (prev_vehicle_type_id() == vehmid2) ||                                              \
   (prev_vehicle_type_id() == vehmid3)) ])                                             \
{ 1: name##_sprites_left;                                                              \
     name##_sprites_2; }                                                               \
switch (FEAT_TRAINS, SELF, name##_sprites_start,                                       \
[  set_offset_to(-2),                                                                  \
  ((prev_vehicle_type_id() == vehmid1) ||                                              \
   (prev_vehicle_type_id() == vehmid2) ||                                              \
   (prev_vehicle_type_id() == vehmid3)) ])                                             \
{ 1: name##_sprites_right;                                                             \
     name##_sprites_ml; }                                                              \

// Выбор ориентации кабины секции для СМЕ (схема с 4 альтернативами и 1 средней секцией)

#define engine_direction_template6m(name, vehid1, vehid2, vehid3, vehid4, vehid5, vehmid)        \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,                                                    \
[ set_offset_to(2),                                                                              \
  (prev_vehicle_type_id() == vehid1) ||                                                          \
  (prev_vehicle_type_id() == vehid2) ||                                                          \
  (prev_vehicle_type_id() == vehid3) ||                                                          \
  (prev_vehicle_type_id() == vehid4) ||                                                          \
  (prev_vehicle_type_id() == vehid5) ||                                                          \
  (position_in_consist == 0) ])                                                                  \
{ 1: name##_sprites_left;                                                                        \
     name##_sprites_right;}                                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_old,                                                   \
  ((LOAD_TEMP(0) - count_veh_id(vehid1) -                                                        \
    count_veh_id(vehid5) - count_veh_id(vehid4) - count_veh_id(vehid3) - count_veh_id(vehid2) -  \
    count_veh_id(vehmid) + 1) % 2))                                                              \
{ 1: name##_sprites_2l;                                                                          \
     name##_sprites_right;}                                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_16,                                                    \
[  set_offset_to(-16),                                                                           \
  ((prev_vehicle_type_id() == vehid1) ||                                                         \
   (prev_vehicle_type_id() == vehid2) ||                                                         \
   (prev_vehicle_type_id() == vehid3) ||                                                         \
   (prev_vehicle_type_id() == vehid4) ||                                                         \
   (prev_vehicle_type_id() == vehid5)) +                                                         \
  (((prev_vehicle_type_id() == vehmid)) * 2) ])                                                  \
{ 1: name##_sprites_old;                                                                         \
  2: name##_sprites_2l;                                                                          \
     name##_sprites_right;}                                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_14,                                                    \
[  set_offset_to(-14),                                                                           \
  ((prev_vehicle_type_id() == vehid1) ||                                                         \
   (prev_vehicle_type_id() == vehid2) ||                                                         \
   (prev_vehicle_type_id() == vehid3) ||                                                         \
   (prev_vehicle_type_id() == vehid4) ||                                                         \
   (prev_vehicle_type_id() == vehid5)) +                                                         \
  (((prev_vehicle_type_id() == vehmid)) * 2) ])                                                  \
{ 1: name##_sprites_16;                                                                          \
  2: name##_sprites_right;                                                                       \
     name##_sprites_2l;}                                                                         \
switch (FEAT_TRAINS, SELF, name##_sprites_12,                                                    \
[  set_offset_to(-12),                                                                           \
  ((prev_vehicle_type_id() == vehid1) ||                                                         \
   (prev_vehicle_type_id() == vehid2) ||                                                         \
   (prev_vehicle_type_id() == vehid3) ||                                                         \
   (prev_vehicle_type_id() == vehid4) ||                                                         \
   (prev_vehicle_type_id() == vehid5)) +                                                         \
  (((prev_vehicle_type_id() == vehmid)) * 2) ])                                                  \
{ 1: name##_sprites_14;                                                                          \
  2: name##_sprites_2l;                                                                          \
     name##_sprites_right;}                                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_10,                                                    \
[  set_offset_to(-10),                                                                           \
  ((prev_vehicle_type_id() == vehid1) ||                                                         \
   (prev_vehicle_type_id() == vehid2) ||                                                         \
   (prev_vehicle_type_id() == vehid3) ||                                                         \
   (prev_vehicle_type_id() == vehid4) ||                                                         \
   (prev_vehicle_type_id() == vehid5)) +                                                         \
  (((prev_vehicle_type_id() == vehmid)) * 2) ])                                                  \
{ 1: name##_sprites_12;                                                                          \
  2: name##_sprites_right;                                                                       \
     name##_sprites_2l;}                                                                         \
switch (FEAT_TRAINS, SELF, name##_sprites_8,                                                     \
[  set_offset_to(-8),                                                                            \
  ((prev_vehicle_type_id() == vehid1) ||                                                         \
   (prev_vehicle_type_id() == vehid2) ||                                                         \
   (prev_vehicle_type_id() == vehid3) ||                                                         \
   (prev_vehicle_type_id() == vehid4) ||                                                         \
   (prev_vehicle_type_id() == vehid5)) +                                                         \
  (((prev_vehicle_type_id() == vehmid)) * 2) ])                                                  \
{ 1: name##_sprites_10;                                                                          \
  2: name##_sprites_2l;                                                                          \
     name##_sprites_right;}                                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_6,                                                     \
[  set_offset_to(-6),                                                                            \
  ((prev_vehicle_type_id() == vehid1) ||                                                         \
   (prev_vehicle_type_id() == vehid2) ||                                                         \
   (prev_vehicle_type_id() == vehid3) ||                                                         \
   (prev_vehicle_type_id() == vehid4) ||                                                         \
   (prev_vehicle_type_id() == vehid5)) +                                                         \
  (((prev_vehicle_type_id() == vehmid)) * 2) ])                                                  \
{ 1: name##_sprites_8;                                                                           \
  2: name##_sprites_right;                                                                       \
     name##_sprites_2l;}                                                                         \
switch (FEAT_TRAINS, SELF, name##_sprites_4,                                                     \
[  set_offset_to(-4),                                                                            \
  ((prev_vehicle_type_id() == vehid1) ||                                                         \
   (prev_vehicle_type_id() == vehid2) ||                                                         \
   (prev_vehicle_type_id() == vehid3) ||                                                         \
   (prev_vehicle_type_id() == vehid4) ||                                                         \
   (prev_vehicle_type_id() == vehid5)) +                                                         \
  (((prev_vehicle_type_id() == vehmid)) * 2) ])                                                  \
{ 1: name##_sprites_6;                                                                           \
  2: name##_sprites_2l;                                                                          \
     name##_sprites_right;}                                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_2,                                                     \
[  set_offset_to(-2),                                                                            \
  ((prev_vehicle_type_id() == vehid1) ||                                                         \
   (prev_vehicle_type_id() == vehid2) ||                                                         \
   (prev_vehicle_type_id() == vehid3) ||                                                         \
   (prev_vehicle_type_id() == vehid4) ||                                                         \
   (prev_vehicle_type_id() == vehid5)) +                                                         \
  (((prev_vehicle_type_id() == vehmid)) * 2) ])                                                  \
{ 1: name##_sprites_4;                                                                           \
  2: name##_sprites_right;                                                                       \
     name##_sprites_2l; }                                                                        \
switch (FEAT_TRAINS, SELF, name##_sprites_ml,                                                    \
[  set_offset_to(2),                                                                             \
  ((prev_vehicle_type_id() == vehmid)) ])                                                        \
{ 1: name##_sprites_left;                                                                        \
     name##_sprites_2; }                                                                         \
switch (FEAT_TRAINS, SELF, name##_sprites_start,                                                 \
[  set_offset_to(-2),                                                                            \
  ((prev_vehicle_type_id() == vehmid)) ])                                                        \
{ 1: name##_sprites_right;                                                                       \
     name##_sprites_ml; }                                                                        \

// Выбор ориентации кабины секции для СМЕ (схема с 3 альтернативами и 2-я средними секциями)

#define engine_direction_template6m2(name, vehid1, vehid2, vehid3, vehid4, vehmid1, vehmid2)  \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,                                                 \
[ set_offset_to(2),                                                                           \
  (prev_vehicle_type_id() == vehid1) ||                                                       \
  (prev_vehicle_type_id() == vehid2) ||                                                       \
  (prev_vehicle_type_id() == vehid3) ||                                                       \
  (prev_vehicle_type_id() == vehid4) ||                                                       \
  (position_in_consist == 0) ])                                                               \
{ 1: name##_sprites_left;                                                                     \
     name##_sprites_right;}                                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_old,                                                \
  ((LOAD_TEMP(0) -                                                                            \
    count_veh_id(vehid1) -                                                                    \
    count_veh_id(vehid2) -                                                                    \
    count_veh_id(vehid3) -                                                                    \
    count_veh_id(vehid4) -                                                                    \
    count_veh_id(vehmid1) -                                                                   \
    count_veh_id(vehmid2) + 1) % 2))                                                          \
{ 1: name##_sprites_2l;                                                                       \
     name##_sprites_right;}                                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_16,                                                 \
[  set_offset_to(-16),                                                                        \
  ((prev_vehicle_type_id() == vehid1) ||                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                      \
   (prev_vehicle_type_id() == vehid4)) +                                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                                    \
    (prev_vehicle_type_id() == vehmid2)) * 2) ])                                              \
{ 1: name##_sprites_old;                                                                      \
  2: name##_sprites_2l;                                                                       \
     name##_sprites_right;}                                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_14,                                                 \
[  set_offset_to(-14),                                                                        \
  ((prev_vehicle_type_id() == vehid1) ||                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                      \
   (prev_vehicle_type_id() == vehid4)) +                                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                                    \
   (prev_vehicle_type_id() == vehmid2)) * 2) ])                                               \
{ 1: name##_sprites_16;                                                                       \
  2: name##_sprites_right;                                                                    \
     name##_sprites_2l;}                                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_12,                                                 \
[  set_offset_to(-12),                                                                        \
  ((prev_vehicle_type_id() == vehid1) ||                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                      \
   (prev_vehicle_type_id() == vehid4)) +                                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                                    \
   (prev_vehicle_type_id() == vehmid2)) * 2) ])                                               \
{ 1: name##_sprites_14;                                                                       \
  2: name##_sprites_2l;                                                                       \
     name##_sprites_right;}                                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_10,                                                 \
[  set_offset_to(-10),                                                                        \
  ((prev_vehicle_type_id() == vehid1) ||                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                      \
   (prev_vehicle_type_id() == vehid4)) +                                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                                    \
   (prev_vehicle_type_id() == vehmid2)) * 2) ])                                               \
{ 1: name##_sprites_12;                                                                       \
  2: name##_sprites_right;                                                                    \
     name##_sprites_2l;}                                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_8,                                                  \
[  set_offset_to(-8),                                                                         \
  ((prev_vehicle_type_id() == vehid1) ||                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                      \
   (prev_vehicle_type_id() == vehid4)) +                                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                                    \
   (prev_vehicle_type_id() == vehmid2)) * 2) ])                                               \
{ 1: name##_sprites_10;                                                                       \
  2: name##_sprites_2l;                                                                       \
     name##_sprites_right;}                                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_6,                                                  \
[  set_offset_to(-6),                                                                         \
  ((prev_vehicle_type_id() == vehid1) ||                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                      \
   (prev_vehicle_type_id() == vehid4)) +                                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                                    \
   (prev_vehicle_type_id() == vehmid2)) * 2) ])                                               \
{ 1: name##_sprites_8;                                                                        \
  2: name##_sprites_right;                                                                    \
     name##_sprites_2l;}                                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_4,                                                  \
[  set_offset_to(-4),                                                                         \
  ((prev_vehicle_type_id() == vehid1) ||                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                      \
   (prev_vehicle_type_id() == vehid4)) +                                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                                    \
   (prev_vehicle_type_id() == vehmid2)) * 2) ])                                               \
{ 1: name##_sprites_6;                                                                        \
  2: name##_sprites_2l;                                                                       \
     name##_sprites_right;}                                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_2,                                                  \
[  set_offset_to(-2),                                                                         \
  ((prev_vehicle_type_id() == vehid1) ||                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                      \
   (prev_vehicle_type_id() == vehid4)) +                                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                                    \
   (prev_vehicle_type_id() == vehmid2)) * 2) ])                                               \
{ 1: name##_sprites_4;                                                                        \
  2: name##_sprites_right;                                                                    \
     name##_sprites_2l; }                                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_ml,                                                 \
[  set_offset_to(2),                                                                          \
  ((prev_vehicle_type_id() == vehmid1) ||                                                     \
   (prev_vehicle_type_id() == vehmid2)) ])                                                    \
{ 1: name##_sprites_left;                                                                     \
     name##_sprites_2; }                                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_start,                                              \
[  set_offset_to(-2),                                                                         \
  ((prev_vehicle_type_id() == vehmid1) ||                                                     \
   (prev_vehicle_type_id() == vehmid2)) ])                                                    \
{ 1: name##_sprites_right;                                                                    \
     name##_sprites_ml; }                                                                     \

// Выбор ориентации кабины секции для СМЕ (схема с альтернативой и 4-я средними секциями)

#define engine_direction_template6m3(name, vehid1, vehid2, vehid3,     \
                                           vehmid1, vehmid2, vehmid3)  \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,                          \
[ set_offset_to(2),                                                    \
  (prev_vehicle_type_id() == vehid1) ||                                \
  (prev_vehicle_type_id() == vehid2) ||                                \
  (prev_vehicle_type_id() == vehid3) ||                                \
  (position_in_consist == 0) ])                                        \
{ 1: name##_sprites_left;                                              \
     name##_sprites_right;}                                            \
switch (FEAT_TRAINS, SELF, name##_sprites_old,                         \
  ((LOAD_TEMP(0) -                                                     \
    count_veh_id(vehmid1) -                                            \
    count_veh_id(vehmid2) -                                            \
    count_veh_id(vehmid3) -                                            \
    count_veh_id(vehmid1) -                                            \
    count_veh_id(vehmid2) -                                            \
    count_veh_id(vehmid3) + 1) % 2))                                   \
{ 1: name##_sprites_2l;                                                \
     name##_sprites_right;}                                            \
switch (FEAT_TRAINS, SELF, name##_sprites_16,                          \
[  set_offset_to(-16),                                                 \
  ((prev_vehicle_type_id() == vehid1) ||                               \
   (prev_vehicle_type_id() == vehid2) ||                               \
   (prev_vehicle_type_id() == vehid3)) +                               \
  (((prev_vehicle_type_id() == vehmid1) ||                             \
    (prev_vehicle_type_id() == vehmid2) ||                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                       \
{ 1: name##_sprites_old;                                               \
  2: name##_sprites_2l;                                                \
     name##_sprites_right;}                                            \
switch (FEAT_TRAINS, SELF, name##_sprites_14,                          \
[  set_offset_to(-14),                                                 \
  ((prev_vehicle_type_id() == vehid1) ||                               \
   (prev_vehicle_type_id() == vehid2) ||                               \
   (prev_vehicle_type_id() == vehid3)) +                               \
  (((prev_vehicle_type_id() == vehmid1) ||                             \
    (prev_vehicle_type_id() == vehmid2) ||                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                       \
{ 1: name##_sprites_16;                                                \
  2: name##_sprites_right;                                             \
     name##_sprites_2l;}                                               \
switch (FEAT_TRAINS, SELF, name##_sprites_12,                          \
[  set_offset_to(-12),                                                 \
  ((prev_vehicle_type_id() == vehid1) ||                               \
   (prev_vehicle_type_id() == vehid2) ||                               \
   (prev_vehicle_type_id() == vehid3)) +                               \
  (((prev_vehicle_type_id() == vehmid1) ||                             \
    (prev_vehicle_type_id() == vehmid2) ||                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                       \
{ 1: name##_sprites_14;                                                \
  2: name##_sprites_2l;                                                \
     name##_sprites_right;}                                            \
switch (FEAT_TRAINS, SELF, name##_sprites_10,                          \
[  set_offset_to(-10),                                                 \
  ((prev_vehicle_type_id() == vehid1) ||                               \
   (prev_vehicle_type_id() == vehid2) ||                               \
   (prev_vehicle_type_id() == vehid3)) +                               \
  (((prev_vehicle_type_id() == vehmid1) ||                             \
    (prev_vehicle_type_id() == vehmid2) ||                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                       \
{ 1: name##_sprites_12;                                                \
  2: name##_sprites_right;                                             \
     name##_sprites_2l;}                                               \
switch (FEAT_TRAINS, SELF, name##_sprites_8,                           \
[  set_offset_to(-8),                                                  \
  ((prev_vehicle_type_id() == vehid1) ||                               \
   (prev_vehicle_type_id() == vehid2) ||                               \
   (prev_vehicle_type_id() == vehid3)) +                               \
  (((prev_vehicle_type_id() == vehmid1) ||                             \
    (prev_vehicle_type_id() == vehmid2) ||                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                       \
{ 1: name##_sprites_10;                                                \
  2: name##_sprites_2l;                                                \
     name##_sprites_right;}                                            \
switch (FEAT_TRAINS, SELF, name##_sprites_6,                           \
[  set_offset_to(-6),                                                  \
  ((prev_vehicle_type_id() == vehid1) ||                               \
   (prev_vehicle_type_id() == vehid2) ||                               \
   (prev_vehicle_type_id() == vehid3)) +                               \
  (((prev_vehicle_type_id() == vehmid1) ||                             \
    (prev_vehicle_type_id() == vehmid2) ||                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                       \
{ 1: name##_sprites_8;                                                 \
  2: name##_sprites_right;                                             \
     name##_sprites_2l;}                                               \
switch (FEAT_TRAINS, SELF, name##_sprites_4,                           \
[  set_offset_to(-4),                                                  \
  ((prev_vehicle_type_id() == vehid1) ||                               \
   (prev_vehicle_type_id() == vehid2) ||                               \
   (prev_vehicle_type_id() == vehid3)) +                               \
  (((prev_vehicle_type_id() == vehmid1) ||                             \
    (prev_vehicle_type_id() == vehmid2) ||                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                       \
{ 1: name##_sprites_6;                                                 \
  2: name##_sprites_2l;                                                \
     name##_sprites_right;}                                            \
switch (FEAT_TRAINS, SELF, name##_sprites_2,                           \
[  set_offset_to(-2),                                                  \
  ((prev_vehicle_type_id() == vehid1) ||                               \
   (prev_vehicle_type_id() == vehid2) ||                               \
   (prev_vehicle_type_id() == vehid3)) +                               \
  (((prev_vehicle_type_id() == vehmid1) ||                             \
    (prev_vehicle_type_id() == vehmid2) ||                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                       \
{ 1: name##_sprites_4;                                                 \
  2: name##_sprites_right;                                             \
     name##_sprites_2l; }                                              \
switch (FEAT_TRAINS, SELF, name##_sprites_ml,                          \
[  set_offset_to(2),                                                   \
  ((prev_vehicle_type_id() == vehmid1) ||                              \
   (prev_vehicle_type_id() == vehmid2) ||                              \
   (prev_vehicle_type_id() == vehmid3)) ])                             \
{ 1: name##_sprites_left;                                              \
     name##_sprites_2; }                                               \
switch (FEAT_TRAINS, SELF, name##_sprites_start,                       \
[  set_offset_to(-2),                                                  \
  ((prev_vehicle_type_id() == vehmid1) ||                              \
   (prev_vehicle_type_id() == vehmid2) ||                              \
   (prev_vehicle_type_id() == vehmid3)) ])                             \
{ 1: name##_sprites_right;                                             \
     name##_sprites_ml; }                                              \

// Выбор ориентации кабины секции для СМЕ (схема с альтернативой и 3-я средними секциями)

#define engine_direction_template6m4(name, vehid1, vehid2, vehmid1, vehmid2, vehmid3, vehmid4)  \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,                                                   \
[ set_offset_to(2),                                                                             \
  (prev_vehicle_type_id() == vehid1) ||                                                         \
  (prev_vehicle_type_id() == vehid2) ||                                                         \
  (position_in_consist == 0) ])                                                                 \
{ 1: name##_sprites_left;                                                                       \
     name##_sprites_right;}                                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_old,                                                  \
  ((LOAD_TEMP(0) -                                                                              \
    count_veh_id(vehid1) -                                                                      \
    count_veh_id(vehid2) -                                                                      \
    count_veh_id(vehmid1) -                                                                     \
    count_veh_id(vehmid2) -                                                                     \
    count_veh_id(vehmid3) -                                                                     \
    count_veh_id(vehmid4) + 1) % 2))                                                            \
{ 1: name##_sprites_2l;                                                                         \
     name##_sprites_right;}                                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_16,                                                   \
[  set_offset_to(-16),                                                                          \
  ((prev_vehicle_type_id() == vehid1) ||                                                        \
   (prev_vehicle_type_id() == vehid2)) +                                                        \
  (((prev_vehicle_type_id() == vehmid1) ||                                                      \
    (prev_vehicle_type_id() == vehmid2) ||                                                      \
    (prev_vehicle_type_id() == vehmid3) ||                                                      \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                \
{ 1: name##_sprites_old;                                                                        \
  2: name##_sprites_2l;                                                                         \
     name##_sprites_right;}                                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_14,                                                   \
[  set_offset_to(-14),                                                                          \
  ((prev_vehicle_type_id() == vehid1) ||                                                        \
   (prev_vehicle_type_id() == vehid2)) +                                                        \
  (((prev_vehicle_type_id() == vehmid1) ||                                                      \
   (prev_vehicle_type_id() == vehmid2) ||                                                       \
   (prev_vehicle_type_id() == vehmid3) ||                                                       \
   (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                 \
{ 1: name##_sprites_16;                                                                         \
  2: name##_sprites_right;                                                                      \
     name##_sprites_2l;}                                                                        \
switch (FEAT_TRAINS, SELF, name##_sprites_12,                                                   \
[  set_offset_to(-12),                                                                          \
  ((prev_vehicle_type_id() == vehid1) ||                                                        \
   (prev_vehicle_type_id() == vehid2)) +                                                        \
  (((prev_vehicle_type_id() == vehmid1) ||                                                      \
   (prev_vehicle_type_id() == vehmid2) ||                                                       \
   (prev_vehicle_type_id() == vehmid3) ||                                                       \
   (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                 \
{ 1: name##_sprites_14;                                                                         \
  2: name##_sprites_2l;                                                                         \
     name##_sprites_right;}                                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_10,                                                   \
[  set_offset_to(-10),                                                                          \
  ((prev_vehicle_type_id() == vehid1) ||                                                        \
   (prev_vehicle_type_id() == vehid2)) +                                                        \
  (((prev_vehicle_type_id() == vehmid1) ||                                                      \
   (prev_vehicle_type_id() == vehmid2) ||                                                       \
   (prev_vehicle_type_id() == vehmid3) ||                                                       \
   (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                 \
{ 1: name##_sprites_12;                                                                         \
  2: name##_sprites_right;                                                                      \
     name##_sprites_2l;}                                                                        \
switch (FEAT_TRAINS, SELF, name##_sprites_8,                                                    \
[  set_offset_to(-8),                                                                           \
  ((prev_vehicle_type_id() == vehid1) ||                                                        \
   (prev_vehicle_type_id() == vehid2)) +                                                        \
  (((prev_vehicle_type_id() == vehmid1) ||                                                      \
   (prev_vehicle_type_id() == vehmid2) ||                                                       \
   (prev_vehicle_type_id() == vehmid3) ||                                                       \
   (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                 \
{ 1: name##_sprites_10;                                                                         \
  2: name##_sprites_2l;                                                                         \
     name##_sprites_right;}                                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_6,                                                    \
[  set_offset_to(-6),                                                                           \
  ((prev_vehicle_type_id() == vehid1) ||                                                        \
   (prev_vehicle_type_id() == vehid2)) +                                                        \
  (((prev_vehicle_type_id() == vehmid1) ||                                                      \
   (prev_vehicle_type_id() == vehmid2) ||                                                       \
   (prev_vehicle_type_id() == vehmid3) ||                                                       \
   (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                 \
{ 1: name##_sprites_8;                                                                          \
  2: name##_sprites_right;                                                                      \
     name##_sprites_2l;}                                                                        \
switch (FEAT_TRAINS, SELF, name##_sprites_4,                                                    \
[  set_offset_to(-4),                                                                           \
  ((prev_vehicle_type_id() == vehid1) ||                                                        \
   (prev_vehicle_type_id() == vehid2)) +                                                        \
  (((prev_vehicle_type_id() == vehmid1) ||                                                      \
   (prev_vehicle_type_id() == vehmid2) ||                                                       \
   (prev_vehicle_type_id() == vehmid3) ||                                                       \
   (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                 \
{ 1: name##_sprites_6;                                                                          \
  2: name##_sprites_2l;                                                                         \
     name##_sprites_right;}                                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_2,                                                    \
[  set_offset_to(-2),                                                                           \
  ((prev_vehicle_type_id() == vehid1) ||                                                        \
   (prev_vehicle_type_id() == vehid2)) +                                                        \
  (((prev_vehicle_type_id() == vehmid1) ||                                                      \
   (prev_vehicle_type_id() == vehmid2) ||                                                       \
   (prev_vehicle_type_id() == vehmid3) ||                                                       \
   (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                 \
{ 1: name##_sprites_4;                                                                          \
  2: name##_sprites_right;                                                                      \
     name##_sprites_2l; }                                                                       \
switch (FEAT_TRAINS, SELF, name##_sprites_ml,                                                   \
[  set_offset_to(2),                                                                            \
  ((prev_vehicle_type_id() == vehmid1) ||                                                       \
   (prev_vehicle_type_id() == vehmid2) ||                                                       \
   (prev_vehicle_type_id() == vehmid3) ||                                                       \
   (prev_vehicle_type_id() == vehmid4)) ])                                                      \
{ 1: name##_sprites_left;                                                                       \
     name##_sprites_2; }                                                                        \
switch (FEAT_TRAINS, SELF, name##_sprites_start,                                                \
[  set_offset_to(-2),                                                                           \
  ((prev_vehicle_type_id() == vehmid1) ||                                                       \
   (prev_vehicle_type_id() == vehmid2) ||                                                       \
   (prev_vehicle_type_id() == vehmid3) ||                                                       \
   (prev_vehicle_type_id() == vehmid4)) ])                                                      \
{ 1: name##_sprites_right;                                                                      \
     name##_sprites_ml; }                                                                       \

// Выбор ориентации кабины секции для СМЕ (схема с 5 альтернативами и 1 средней секцией)

#define engine_direction_template7m(name, vehid1, vehid2, vehid3, vehid4, vehid5, vehid6, vehmid)                       \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,                                                                           \
[ set_offset_to(2),                                                                                                     \
  (prev_vehicle_type_id() == vehid1) ||                                                                                 \
  (prev_vehicle_type_id() == vehid2) ||                                                                                 \
  (prev_vehicle_type_id() == vehid3) ||                                                                                 \
  (prev_vehicle_type_id() == vehid4) ||                                                                                 \
  (prev_vehicle_type_id() == vehid5) ||                                                                                 \
  (prev_vehicle_type_id() == vehid6) ||                                                                                 \
  (position_in_consist == 0) ])                                                                                         \
{ 1: name##_sprites_left;                                                                                               \
     name##_sprites_right;}                                                                                             \
switch (FEAT_TRAINS, SELF, name##_sprites_old,                                                                          \
  ((LOAD_TEMP(0) - count_veh_id(vehid1) -                                                                               \
    count_veh_id(vehid6) - count_veh_id(vehid5) - count_veh_id(vehid4) - count_veh_id(vehid3) - count_veh_id(vehid2) -  \
    count_veh_id(vehmid) + 1) % 2))                                                                                     \
{ 1: name##_sprites_2l;                                                                                                 \
     name##_sprites_right;}                                                                                             \
switch (FEAT_TRAINS, SELF, name##_sprites_16,                                                                           \
[  set_offset_to(-16),                                                                                                  \
  ((prev_vehicle_type_id() == vehid1) ||                                                                                \
   (prev_vehicle_type_id() == vehid2) ||                                                                                \
   (prev_vehicle_type_id() == vehid3) ||                                                                                \
   (prev_vehicle_type_id() == vehid4) ||                                                                                \
   (prev_vehicle_type_id() == vehid5) ||                                                                                \
   (prev_vehicle_type_id() == vehid6)) +                                                                                \
  (((prev_vehicle_type_id() == vehmid)) * 2) ])                                                                         \
{ 1: name##_sprites_old;                                                                                                \
  2: name##_sprites_2l;                                                                                                 \
     name##_sprites_right;}                                                                                             \
switch (FEAT_TRAINS, SELF, name##_sprites_14,                                                                           \
[  set_offset_to(-14),                                                                                                  \
  ((prev_vehicle_type_id() == vehid1) ||                                                                                \
   (prev_vehicle_type_id() == vehid2) ||                                                                                \
   (prev_vehicle_type_id() == vehid3) ||                                                                                \
   (prev_vehicle_type_id() == vehid4) ||                                                                                \
   (prev_vehicle_type_id() == vehid5) ||                                                                                \
   (prev_vehicle_type_id() == vehid6)) +                                                                                \
  (((prev_vehicle_type_id() == vehmid)) * 2) ])                                                                         \
{ 1: name##_sprites_16;                                                                                                 \
  2: name##_sprites_right;                                                                                              \
     name##_sprites_2l;}                                                                                                \
switch (FEAT_TRAINS, SELF, name##_sprites_12,                                                                           \
[  set_offset_to(-12),                                                                                                  \
  ((prev_vehicle_type_id() == vehid1) ||                                                                                \
   (prev_vehicle_type_id() == vehid2) ||                                                                                \
   (prev_vehicle_type_id() == vehid3) ||                                                                                \
   (prev_vehicle_type_id() == vehid4) ||                                                                                \
   (prev_vehicle_type_id() == vehid5) ||                                                                                \
   (prev_vehicle_type_id() == vehid6)) +                                                                                \
  (((prev_vehicle_type_id() == vehmid)) * 2) ])                                                                         \
{ 1: name##_sprites_14;                                                                                                 \
  2: name##_sprites_2l;                                                                                                 \
     name##_sprites_right;}                                                                                             \
switch (FEAT_TRAINS, SELF, name##_sprites_10,                                                                           \
[  set_offset_to(-10),                                                                                                  \
  ((prev_vehicle_type_id() == vehid1) ||                                                                                \
   (prev_vehicle_type_id() == vehid2) ||                                                                                \
   (prev_vehicle_type_id() == vehid3) ||                                                                                \
   (prev_vehicle_type_id() == vehid4) ||                                                                                \
   (prev_vehicle_type_id() == vehid5) ||                                                                                \
   (prev_vehicle_type_id() == vehid6)) +                                                                                \
  (((prev_vehicle_type_id() == vehmid)) * 2) ])                                                                         \
{ 1: name##_sprites_12;                                                                                                 \
  2: name##_sprites_right;                                                                                              \
     name##_sprites_2l;}                                                                                                \
switch (FEAT_TRAINS, SELF, name##_sprites_8,                                                                            \
[  set_offset_to(-8),                                                                                                   \
  ((prev_vehicle_type_id() == vehid1) ||                                                                                \
   (prev_vehicle_type_id() == vehid2) ||                                                                                \
   (prev_vehicle_type_id() == vehid3) ||                                                                                \
   (prev_vehicle_type_id() == vehid4) ||                                                                                \
   (prev_vehicle_type_id() == vehid5) ||                                                                                \
   (prev_vehicle_type_id() == vehid6)) +                                                                                \
  (((prev_vehicle_type_id() == vehmid)) * 2) ])                                                                         \
{ 1: name##_sprites_10;                                                                                                 \
  2: name##_sprites_2l;                                                                                                 \
     name##_sprites_right;}                                                                                             \
switch (FEAT_TRAINS, SELF, name##_sprites_6,                                                                            \
[  set_offset_to(-6),                                                                                                   \
  ((prev_vehicle_type_id() == vehid1) ||                                                                                \
   (prev_vehicle_type_id() == vehid2) ||                                                                                \
   (prev_vehicle_type_id() == vehid3) ||                                                                                \
   (prev_vehicle_type_id() == vehid4) ||                                                                                \
   (prev_vehicle_type_id() == vehid5) ||                                                                                \
   (prev_vehicle_type_id() == vehid6)) +                                                                                \
  (((prev_vehicle_type_id() == vehmid)) * 2) ])                                                                         \
{ 1: name##_sprites_8;                                                                                                  \
  2: name##_sprites_right;                                                                                              \
     name##_sprites_2l;}                                                                                                \
switch (FEAT_TRAINS, SELF, name##_sprites_4,                                                                            \
[  set_offset_to(-4),                                                                                                   \
  ((prev_vehicle_type_id() == vehid1) ||                                                                                \
   (prev_vehicle_type_id() == vehid2) ||                                                                                \
   (prev_vehicle_type_id() == vehid3) ||                                                                                \
   (prev_vehicle_type_id() == vehid4) ||                                                                                \
   (prev_vehicle_type_id() == vehid5) ||                                                                                \
   (prev_vehicle_type_id() == vehid6)) +                                                                                \
  (((prev_vehicle_type_id() == vehmid)) * 2) ])                                                                         \
{ 1: name##_sprites_6;                                                                                                  \
  2: name##_sprites_2l;                                                                                                 \
     name##_sprites_right;}                                                                                             \
switch (FEAT_TRAINS, SELF, name##_sprites_2,                                                                            \
[  set_offset_to(-2),                                                                                                   \
  ((prev_vehicle_type_id() == vehid1) ||                                                                                \
   (prev_vehicle_type_id() == vehid2) ||                                                                                \
   (prev_vehicle_type_id() == vehid3) ||                                                                                \
   (prev_vehicle_type_id() == vehid4) ||                                                                                \
   (prev_vehicle_type_id() == vehid5) ||                                                                                \
   (prev_vehicle_type_id() == vehid6)) +                                                                                \
  (((prev_vehicle_type_id() == vehmid)) * 2) ])                                                                         \
{ 1: name##_sprites_4;                                                                                                  \
  2: name##_sprites_right;                                                                                              \
     name##_sprites_2l; }                                                                                               \
switch (FEAT_TRAINS, SELF, name##_sprites_ml,                                                                           \
[  set_offset_to(2),                                                                                                    \
  ((prev_vehicle_type_id() == vehmid)) ])                                                                               \
{ 1: name##_sprites_left;                                                                                               \
     name##_sprites_2; }                                                                                                \
switch (FEAT_TRAINS, SELF, name##_sprites_start,                                                                        \
[  set_offset_to(-2),                                                                                                   \
  ((prev_vehicle_type_id() == vehmid)) ])                                                                               \
{ 1: name##_sprites_right;                                                                                              \
     name##_sprites_ml; }                                                                                               \

// Выбор ориентации кабины секции для СМЕ (схема с 3 альтернативами и 3-я средними секциями)

#define engine_direction_template7m3(name, vehid1, vehid2, vehid3, vehid4, vehmid1, vehmid2, vehmid3)  \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,                                                          \
[ set_offset_to(2),                                                                                    \
  (prev_vehicle_type_id() == vehid1) ||                                                                \
  (prev_vehicle_type_id() == vehid2) ||                                                                \
  (prev_vehicle_type_id() == vehid3) ||                                                                \
  (prev_vehicle_type_id() == vehid4) ||                                                                \
  (position_in_consist == 0) ])                                                                        \
{ 1: name##_sprites_left;                                                                              \
     name##_sprites_right;}                                                                            \
switch (FEAT_TRAINS, SELF, name##_sprites_old,                                                         \
  ((LOAD_TEMP(0) -                                                                                     \
    count_veh_id(vehid1) -                                                                             \
    count_veh_id(vehid2) -                                                                             \
    count_veh_id(vehid3) -                                                                             \
    count_veh_id(vehid4) -                                                                             \
    count_veh_id(vehmid1) -                                                                            \
    count_veh_id(vehmid2) -                                                                            \
    count_veh_id(vehmid3) + 1) % 2))                                                                   \
{ 1: name##_sprites_2l;                                                                                \
     name##_sprites_right;}                                                                            \
switch (FEAT_TRAINS, SELF, name##_sprites_16,                                                          \
[  set_offset_to(-16),                                                                                 \
  ((prev_vehicle_type_id() == vehid1) ||                                                               \
   (prev_vehicle_type_id() == vehid2) ||                                                               \
   (prev_vehicle_type_id() == vehid3) ||                                                               \
   (prev_vehicle_type_id() == vehid4) ) +                                                              \
  (((prev_vehicle_type_id() == vehmid1) ||                                                             \
    (prev_vehicle_type_id() == vehmid2) ||                                                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                                                       \
{ 1: name##_sprites_old;                                                                               \
  2: name##_sprites_2l;                                                                                \
     name##_sprites_right;}                                                                            \
switch (FEAT_TRAINS, SELF, name##_sprites_14,                                                          \
[  set_offset_to(-14),                                                                                 \
  ((prev_vehicle_type_id() == vehid1) ||                                                               \
   (prev_vehicle_type_id() == vehid2) ||                                                               \
   (prev_vehicle_type_id() == vehid3) ||                                                               \
   (prev_vehicle_type_id() == vehid4)) +                                                               \
  (((prev_vehicle_type_id() == vehmid1) ||                                                             \
    (prev_vehicle_type_id() == vehmid2) ||                                                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                                                       \
{ 1: name##_sprites_16;                                                                                \
  2: name##_sprites_right;                                                                             \
     name##_sprites_2l;}                                                                               \
switch (FEAT_TRAINS, SELF, name##_sprites_12,                                                          \
[  set_offset_to(-12),                                                                                 \
  ((prev_vehicle_type_id() == vehid1) ||                                                               \
   (prev_vehicle_type_id() == vehid2) ||                                                               \
   (prev_vehicle_type_id() == vehid3) ||                                                               \
   (prev_vehicle_type_id() == vehid4)) +                                                               \
  (((prev_vehicle_type_id() == vehmid1) ||                                                             \
    (prev_vehicle_type_id() == vehmid2) ||                                                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                                                       \
{ 1: name##_sprites_14;                                                                                \
  2: name##_sprites_2l;                                                                                \
     name##_sprites_right;}                                                                            \
switch (FEAT_TRAINS, SELF, name##_sprites_10,                                                          \
[  set_offset_to(-10),                                                                                 \
  ((prev_vehicle_type_id() == vehid1) ||                                                               \
   (prev_vehicle_type_id() == vehid2) ||                                                               \
   (prev_vehicle_type_id() == vehid3) ||                                                               \
   (prev_vehicle_type_id() == vehid4)) +                                                               \
  (((prev_vehicle_type_id() == vehmid1) ||                                                             \
    (prev_vehicle_type_id() == vehmid2) ||                                                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                                                       \
{ 1: name##_sprites_12;                                                                                \
  2: name##_sprites_right;                                                                             \
     name##_sprites_2l;}                                                                               \
switch (FEAT_TRAINS, SELF, name##_sprites_8,                                                           \
[  set_offset_to(-8),                                                                                  \
  ((prev_vehicle_type_id() == vehid1) ||                                                               \
   (prev_vehicle_type_id() == vehid2) ||                                                               \
   (prev_vehicle_type_id() == vehid3) ||                                                               \
   (prev_vehicle_type_id() == vehid4)) +                                                               \
  (((prev_vehicle_type_id() == vehmid1) ||                                                             \
    (prev_vehicle_type_id() == vehmid2) ||                                                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                                                       \
{ 1: name##_sprites_10;                                                                                \
  2: name##_sprites_2l;                                                                                \
     name##_sprites_right;}                                                                            \
switch (FEAT_TRAINS, SELF, name##_sprites_6,                                                           \
[  set_offset_to(-6),                                                                                  \
  ((prev_vehicle_type_id() == vehid1) ||                                                               \
   (prev_vehicle_type_id() == vehid2) ||                                                               \
   (prev_vehicle_type_id() == vehid3) ||                                                               \
   (prev_vehicle_type_id() == vehid4)) +                                                               \
  (((prev_vehicle_type_id() == vehmid1) ||                                                             \
    (prev_vehicle_type_id() == vehmid2) ||                                                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                                                       \
{ 1: name##_sprites_8;                                                                                 \
  2: name##_sprites_right;                                                                             \
     name##_sprites_2l;}                                                                               \
switch (FEAT_TRAINS, SELF, name##_sprites_4,                                                           \
[  set_offset_to(-4),                                                                                  \
  ((prev_vehicle_type_id() == vehid1) ||                                                               \
   (prev_vehicle_type_id() == vehid2) ||                                                               \
   (prev_vehicle_type_id() == vehid3) ||                                                               \
   (prev_vehicle_type_id() == vehid4)) +                                                               \
  (((prev_vehicle_type_id() == vehmid1) ||                                                             \
    (prev_vehicle_type_id() == vehmid2) ||                                                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                                                       \
{ 1: name##_sprites_6;                                                                                 \
  2: name##_sprites_2l;                                                                                \
     name##_sprites_right;}                                                                            \
switch (FEAT_TRAINS, SELF, name##_sprites_2,                                                           \
[  set_offset_to(-2),                                                                                  \
  ((prev_vehicle_type_id() == vehid1) ||                                                               \
   (prev_vehicle_type_id() == vehid2) ||                                                               \
   (prev_vehicle_type_id() == vehid3) ||                                                               \
   (prev_vehicle_type_id() == vehid4)) +                                                               \
  (((prev_vehicle_type_id() == vehmid1) ||                                                             \
    (prev_vehicle_type_id() == vehmid2) ||                                                             \
    (prev_vehicle_type_id() == vehmid3)) * 2) ])                                                       \
{ 1: name##_sprites_4;                                                                                 \
  2: name##_sprites_right;                                                                             \
     name##_sprites_2l; }                                                                              \
switch (FEAT_TRAINS, SELF, name##_sprites_ml,                                                          \
[  set_offset_to(2),                                                                                   \
  ((prev_vehicle_type_id() == vehmid1) ||                                                              \
   (prev_vehicle_type_id() == vehmid2) ||                                                              \
   (prev_vehicle_type_id() == vehmid3)) ])                                                             \
{ 1: name##_sprites_left;                                                                              \
     name##_sprites_2; }                                                                               \
switch (FEAT_TRAINS, SELF, name##_sprites_start,                                                       \
[  set_offset_to(-2),                                                                                  \
  ((prev_vehicle_type_id() == vehmid1) ||                                                              \
   (prev_vehicle_type_id() == vehmid2) ||                                                              \
   (prev_vehicle_type_id() == vehmid3)) ])                                                             \
{ 1: name##_sprites_right;                                                                             \
     name##_sprites_ml; }                                                                              \

// Выбор ориентации кабины секции для СМЕ (схема с 5 альтернативами и 2-я средними секциями)

#define engine_direction_template8m2(name, vehid1, vehid2, vehid3, vehid4, vehid5, vehid6, vehmid1, vehmid2)  \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,                                                                 \
[ set_offset_to(2),                                                                                           \
  (prev_vehicle_type_id() == vehid1) ||                                                                       \
  (prev_vehicle_type_id() == vehid2) ||                                                                       \
  (prev_vehicle_type_id() == vehid3) ||                                                                       \
  (prev_vehicle_type_id() == vehid4) ||                                                                       \
  (prev_vehicle_type_id() == vehid5) ||                                                                       \
  (prev_vehicle_type_id() == vehid6) ||                                                                       \
  (position_in_consist == 0) ])                                                                               \
{ 1: name##_sprites_left;                                                                                     \
     name##_sprites_right;}                                                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_old,                                                                \
  ((LOAD_TEMP(0) -                                                                                            \
    count_veh_id(vehid1) -                                                                                    \
    count_veh_id(vehid2) -                                                                                    \
    count_veh_id(vehid3) -                                                                                    \
    count_veh_id(vehid4) -                                                                                    \
    count_veh_id(vehid5) -                                                                                    \
    count_veh_id(vehid6) -                                                                                    \
    count_veh_id(vehmid1) -                                                                                   \
    count_veh_id(vehmid2) + 1) % 2))                                                                          \
{ 1: name##_sprites_2l;                                                                                       \
     name##_sprites_right;}                                                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_16,                                                                 \
[  set_offset_to(-16),                                                                                        \
  ((prev_vehicle_type_id() == vehid1) ||                                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                                      \
   (prev_vehicle_type_id() == vehid4) ||                                                                      \
   (prev_vehicle_type_id() == vehid5) ||                                                                      \
   (prev_vehicle_type_id() == vehid6)) +                                                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                    \
    (prev_vehicle_type_id() == vehmid2)) * 2) ])                                                              \
{ 1: name##_sprites_old;                                                                                      \
  2: name##_sprites_2l;                                                                                       \
     name##_sprites_right;}                                                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_14,                                                                 \
[  set_offset_to(-14),                                                                                        \
  ((prev_vehicle_type_id() == vehid1) ||                                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                                      \
   (prev_vehicle_type_id() == vehid4) ||                                                                      \
   (prev_vehicle_type_id() == vehid5) ||                                                                      \
   (prev_vehicle_type_id() == vehid6)) +                                                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                    \
    (prev_vehicle_type_id() == vehmid2)) * 2) ])                                                              \
{ 1: name##_sprites_16;                                                                                       \
  2: name##_sprites_right;                                                                                    \
     name##_sprites_2l;}                                                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_12,                                                                 \
[  set_offset_to(-12),                                                                                        \
  ((prev_vehicle_type_id() == vehid1) ||                                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                                      \
   (prev_vehicle_type_id() == vehid4) ||                                                                      \
   (prev_vehicle_type_id() == vehid5) ||                                                                      \
   (prev_vehicle_type_id() == vehid6)) +                                                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                    \
    (prev_vehicle_type_id() == vehmid2)) * 2) ])                                                              \
{ 1: name##_sprites_14;                                                                                       \
  2: name##_sprites_2l;                                                                                       \
     name##_sprites_right;}                                                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_10,                                                                 \
[  set_offset_to(-10),                                                                                        \
  ((prev_vehicle_type_id() == vehid1) ||                                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                                      \
   (prev_vehicle_type_id() == vehid4) ||                                                                      \
   (prev_vehicle_type_id() == vehid5) ||                                                                      \
   (prev_vehicle_type_id() == vehid6)) +                                                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                    \
    (prev_vehicle_type_id() == vehmid2)) * 2) ])                                                              \
{ 1: name##_sprites_12;                                                                                       \
  2: name##_sprites_right;                                                                                    \
     name##_sprites_2l;}                                                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_8,                                                                  \
[  set_offset_to(-8),                                                                                         \
  ((prev_vehicle_type_id() == vehid1) ||                                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                                      \
   (prev_vehicle_type_id() == vehid4) ||                                                                      \
   (prev_vehicle_type_id() == vehid5) ||                                                                      \
   (prev_vehicle_type_id() == vehid6)) +                                                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                    \
    (prev_vehicle_type_id() == vehmid2)) * 2) ])                                                              \
{ 1: name##_sprites_10;                                                                                       \
  2: name##_sprites_2l;                                                                                       \
     name##_sprites_right;}                                                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_6,                                                                  \
[  set_offset_to(-6),                                                                                         \
  ((prev_vehicle_type_id() == vehid1) ||                                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                                      \
   (prev_vehicle_type_id() == vehid4) ||                                                                      \
   (prev_vehicle_type_id() == vehid5) ||                                                                      \
   (prev_vehicle_type_id() == vehid6)) +                                                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                    \
    (prev_vehicle_type_id() == vehmid2)) * 2) ])                                                              \
{ 1: name##_sprites_8;                                                                                        \
  2: name##_sprites_right;                                                                                    \
     name##_sprites_2l;}                                                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_4,                                                                  \
[  set_offset_to(-4),                                                                                         \
  ((prev_vehicle_type_id() == vehid1) ||                                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                                      \
   (prev_vehicle_type_id() == vehid4) ||                                                                      \
   (prev_vehicle_type_id() == vehid5) ||                                                                      \
   (prev_vehicle_type_id() == vehid6)) +                                                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                    \
    (prev_vehicle_type_id() == vehmid2)) * 2) ])                                                              \
{ 1: name##_sprites_6;                                                                                        \
  2: name##_sprites_2l;                                                                                       \
     name##_sprites_right;}                                                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_2,                                                                  \
[  set_offset_to(-2),                                                                                         \
  ((prev_vehicle_type_id() == vehid1) ||                                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                                      \
   (prev_vehicle_type_id() == vehid4) ||                                                                      \
   (prev_vehicle_type_id() == vehid5) ||                                                                      \
   (prev_vehicle_type_id() == vehid6)) +                                                                      \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                    \
    (prev_vehicle_type_id() == vehmid2)) * 2) ])                                                              \
{ 1: name##_sprites_4;                                                                                        \
  2: name##_sprites_right;                                                                                    \
     name##_sprites_2l; }                                                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_ml,                                                                 \
[  set_offset_to(2),                                                                                          \
  ((prev_vehicle_type_id() == vehmid1) ||                                                                     \
   (prev_vehicle_type_id() == vehmid2)) ])                                                                    \
{ 1: name##_sprites_left;                                                                                     \
     name##_sprites_2; }                                                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_start,                                                              \
[  set_offset_to(-2),                                                                                         \
  ((prev_vehicle_type_id() == vehmid1) ||                                                                     \
   (prev_vehicle_type_id() == vehmid2)) ])                                                                    \
{ 1: name##_sprites_right;                                                                                    \
     name##_sprites_ml; }                                                                                     \

// Выбор ориентации кабины секции для СМЕ (схема с 3 альтернативами и 4-я средними секциями)

#define engine_direction_template8m4(name, vehid1, vehid2, vehid3, vehid4, vehmid1, vehmid2, vehmid3, vehmid4)  \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,                                                                   \
[ set_offset_to(2),                                                                                             \
  (prev_vehicle_type_id() == vehid1) ||                                                                         \
  (prev_vehicle_type_id() == vehid2) ||                                                                         \
  (prev_vehicle_type_id() == vehid3) ||                                                                         \
  (prev_vehicle_type_id() == vehid4) ||                                                                         \
  (position_in_consist == 0) ])                                                                                 \
{ 1: name##_sprites_left;                                                                                       \
     name##_sprites_right;}                                                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_old,                                                                  \
  ((LOAD_TEMP(0) -                                                                                              \
    count_veh_id(vehid1) -                                                                                      \
    count_veh_id(vehid2) -                                                                                      \
    count_veh_id(vehid3) -                                                                                      \
    count_veh_id(vehid4) -                                                                                      \
    count_veh_id(vehmid1) -                                                                                     \
    count_veh_id(vehmid2) -                                                                                     \
    count_veh_id(vehmid3) -                                                                                     \
    count_veh_id(vehmid4) + 1) % 2))                                                                            \
{ 1: name##_sprites_2l;                                                                                         \
     name##_sprites_right;}                                                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_16,                                                                   \
[  set_offset_to(-16),                                                                                          \
  ((prev_vehicle_type_id() == vehid1) ||                                                                        \
   (prev_vehicle_type_id() == vehid2) ||                                                                        \
   (prev_vehicle_type_id() == vehid3) ||                                                                        \
   (prev_vehicle_type_id() == vehid4) ) +                                                                       \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                      \
    (prev_vehicle_type_id() == vehmid2) ||                                                                      \
    (prev_vehicle_type_id() == vehmid3) ||                                                                      \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                                \
{ 1: name##_sprites_old;                                                                                        \
  2: name##_sprites_2l;                                                                                         \
     name##_sprites_right;}                                                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_14,                                                                   \
[  set_offset_to(-14),                                                                                          \
  ((prev_vehicle_type_id() == vehid1) ||                                                                        \
   (prev_vehicle_type_id() == vehid2) ||                                                                        \
   (prev_vehicle_type_id() == vehid3) ||                                                                        \
   (prev_vehicle_type_id() == vehid4)) +                                                                        \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                      \
    (prev_vehicle_type_id() == vehmid2) ||                                                                      \
    (prev_vehicle_type_id() == vehmid3) ||                                                                      \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                                \
{ 1: name##_sprites_16;                                                                                         \
  2: name##_sprites_right;                                                                                      \
     name##_sprites_2l;}                                                                                        \
switch (FEAT_TRAINS, SELF, name##_sprites_12,                                                                   \
[  set_offset_to(-12),                                                                                          \
  ((prev_vehicle_type_id() == vehid1) ||                                                                        \
   (prev_vehicle_type_id() == vehid2) ||                                                                        \
   (prev_vehicle_type_id() == vehid3) ||                                                                        \
   (prev_vehicle_type_id() == vehid4)) +                                                                        \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                      \
    (prev_vehicle_type_id() == vehmid2) ||                                                                      \
    (prev_vehicle_type_id() == vehmid3) ||                                                                      \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                                \
{ 1: name##_sprites_14;                                                                                         \
  2: name##_sprites_2l;                                                                                         \
     name##_sprites_right;}                                                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_10,                                                                   \
[  set_offset_to(-10),                                                                                          \
  ((prev_vehicle_type_id() == vehid1) ||                                                                        \
   (prev_vehicle_type_id() == vehid2) ||                                                                        \
   (prev_vehicle_type_id() == vehid3) ||                                                                        \
   (prev_vehicle_type_id() == vehid4)) +                                                                        \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                      \
    (prev_vehicle_type_id() == vehmid2) ||                                                                      \
    (prev_vehicle_type_id() == vehmid3) ||                                                                      \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                                \
{ 1: name##_sprites_12;                                                                                         \
  2: name##_sprites_right;                                                                                      \
     name##_sprites_2l;}                                                                                        \
switch (FEAT_TRAINS, SELF, name##_sprites_8,                                                                    \
[  set_offset_to(-8),                                                                                           \
  ((prev_vehicle_type_id() == vehid1) ||                                                                        \
   (prev_vehicle_type_id() == vehid2) ||                                                                        \
   (prev_vehicle_type_id() == vehid3) ||                                                                        \
   (prev_vehicle_type_id() == vehid4)) +                                                                        \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                      \
    (prev_vehicle_type_id() == vehmid2) ||                                                                      \
    (prev_vehicle_type_id() == vehmid3) ||                                                                      \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                                \
{ 1: name##_sprites_10;                                                                                         \
  2: name##_sprites_2l;                                                                                         \
     name##_sprites_right;}                                                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_6,                                                                    \
[  set_offset_to(-6),                                                                                           \
  ((prev_vehicle_type_id() == vehid1) ||                                                                        \
   (prev_vehicle_type_id() == vehid2) ||                                                                        \
   (prev_vehicle_type_id() == vehid3) ||                                                                        \
   (prev_vehicle_type_id() == vehid4)) +                                                                        \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                      \
    (prev_vehicle_type_id() == vehmid2) ||                                                                      \
    (prev_vehicle_type_id() == vehmid3) ||                                                                      \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                                \
{ 1: name##_sprites_8;                                                                                          \
  2: name##_sprites_right;                                                                                      \
     name##_sprites_2l;}                                                                                        \
switch (FEAT_TRAINS, SELF, name##_sprites_4,                                                                    \
[  set_offset_to(-4),                                                                                           \
  ((prev_vehicle_type_id() == vehid1) ||                                                                        \
   (prev_vehicle_type_id() == vehid2) ||                                                                        \
   (prev_vehicle_type_id() == vehid3) ||                                                                        \
   (prev_vehicle_type_id() == vehid4)) +                                                                        \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                      \
    (prev_vehicle_type_id() == vehmid2) ||                                                                      \
    (prev_vehicle_type_id() == vehmid3) ||                                                                      \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                                \
{ 1: name##_sprites_6;                                                                                          \
  2: name##_sprites_2l;                                                                                         \
     name##_sprites_right;}                                                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_2,                                                                    \
[  set_offset_to(-2),                                                                                           \
  ((prev_vehicle_type_id() == vehid1) ||                                                                        \
   (prev_vehicle_type_id() == vehid2) ||                                                                        \
   (prev_vehicle_type_id() == vehid3) ||                                                                        \
   (prev_vehicle_type_id() == vehid4)) +                                                                        \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                      \
    (prev_vehicle_type_id() == vehmid2) ||                                                                      \
    (prev_vehicle_type_id() == vehmid3) ||                                                                      \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                                \
{ 1: name##_sprites_4;                                                                                          \
  2: name##_sprites_right;                                                                                      \
     name##_sprites_2l; }                                                                                       \
switch (FEAT_TRAINS, SELF, name##_sprites_ml,                                                                   \
[  set_offset_to(2),                                                                                            \
  ((prev_vehicle_type_id() == vehmid1) ||                                                                       \
   (prev_vehicle_type_id() == vehmid2) ||                                                                       \
   (prev_vehicle_type_id() == vehmid3) ||                                                                       \
   (prev_vehicle_type_id() == vehmid4)) ])                                                                      \
{ 1: name##_sprites_left;                                                                                       \
     name##_sprites_2; }                                                                                        \
switch (FEAT_TRAINS, SELF, name##_sprites_start,                                                                \
[  set_offset_to(-2),                                                                                           \
  ((prev_vehicle_type_id() == vehmid1) ||                                                                       \
   (prev_vehicle_type_id() == vehmid2) ||                                                                       \
   (prev_vehicle_type_id() == vehmid3) ||                                                                       \
   (prev_vehicle_type_id() == vehmid4)) ])                                                                      \
{ 1: name##_sprites_right;                                                                                      \
     name##_sprites_ml; }                                                                                       \

// Выбор ориентации кабины секции для СМЕ (схема с 9 альтернативами)

#define engine_direction_template10(name, vehid1, vehid2, vehid3, vehid4, vehid5, vehid6, vehid7, vehid8, vehid9, vehid10)  \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,                                                                               \
[ set_offset_to(2),                                                                                                         \
  (prev_vehicle_type_id() == vehid1) ||                                                                                     \
  (prev_vehicle_type_id() == vehid2) ||                                                                                     \
  (prev_vehicle_type_id() == vehid3) ||                                                                                     \
  (prev_vehicle_type_id() == vehid4) ||                                                                                     \
  (prev_vehicle_type_id() == vehid5) ||                                                                                     \
  (prev_vehicle_type_id() == vehid6) ||                                                                                     \
  (prev_vehicle_type_id() == vehid7) ||                                                                                     \
  (prev_vehicle_type_id() == vehid8) ||                                                                                     \
  (prev_vehicle_type_id() == vehid9) ||                                                                                     \
  (prev_vehicle_type_id() == vehid10) ||                                                                                    \
  (position_in_consist == 0) ])                                                                                             \
{ 1: name##_sprites_left;                                                                                                   \
     name##_sprites_right;}                                                                                                 \
switch (FEAT_TRAINS, SELF, name##_sprites_old,                                                                              \
  ((LOAD_TEMP(0) - count_veh_id(vehid1) -                                                                                   \
    count_veh_id(vehid2) - count_veh_id(vehid3) -                                                                           \
    count_veh_id(vehid4) + 1) % 2))                                                                                         \
{ 1: name##_sprites_2l;                                                                                                     \
     name##_sprites_right;}                                                                                                 \
switch (FEAT_TRAINS, SELF, name##_sprites_16,                                                                               \
[  set_offset_to(-16),                                                                                                      \
  (prev_vehicle_type_id() == vehid1) ||                                                                                     \
  (prev_vehicle_type_id() == vehid2) ||                                                                                     \
  (prev_vehicle_type_id() == vehid3) ||                                                                                     \
  (prev_vehicle_type_id() == vehid4) ||                                                                                     \
  (prev_vehicle_type_id() == vehid5) ||                                                                                     \
  (prev_vehicle_type_id() == vehid6) ||                                                                                     \
  (prev_vehicle_type_id() == vehid7) ||                                                                                     \
  (prev_vehicle_type_id() == vehid8) ||                                                                                     \
  (prev_vehicle_type_id() == vehid9) ||                                                                                     \
  (prev_vehicle_type_id() == vehid10)])                                                                                     \
{ 1: name##_sprites_old;                                                                                                    \
     name##_sprites_right;}                                                                                                 \
switch (FEAT_TRAINS, SELF, name##_sprites_14,                                                                               \
[  set_offset_to(-14),                                                                                                      \
  (prev_vehicle_type_id() == vehid1) ||                                                                                     \
  (prev_vehicle_type_id() == vehid2) ||                                                                                     \
  (prev_vehicle_type_id() == vehid3) ||                                                                                     \
  (prev_vehicle_type_id() == vehid4) ||                                                                                     \
  (prev_vehicle_type_id() == vehid5) ||                                                                                     \
  (prev_vehicle_type_id() == vehid6) ||                                                                                     \
  (prev_vehicle_type_id() == vehid7) ||                                                                                     \
  (prev_vehicle_type_id() == vehid8) ||                                                                                     \
  (prev_vehicle_type_id() == vehid9) ||                                                                                     \
  (prev_vehicle_type_id() == vehid10)])                                                                                     \
{ 1: name##_sprites_16;                                                                                                     \
     name##_sprites_2l;}                                                                                                    \
switch (FEAT_TRAINS, SELF, name##_sprites_12,                                                                               \
[  set_offset_to(-12),                                                                                                      \
  (prev_vehicle_type_id() == vehid1) ||                                                                                     \
  (prev_vehicle_type_id() == vehid2) ||                                                                                     \
  (prev_vehicle_type_id() == vehid3) ||                                                                                     \
  (prev_vehicle_type_id() == vehid4) ||                                                                                     \
  (prev_vehicle_type_id() == vehid5) ||                                                                                     \
  (prev_vehicle_type_id() == vehid6) ||                                                                                     \
  (prev_vehicle_type_id() == vehid7) ||                                                                                     \
  (prev_vehicle_type_id() == vehid8) ||                                                                                     \
  (prev_vehicle_type_id() == vehid9) ||                                                                                     \
  (prev_vehicle_type_id() == vehid10)])                                                                                     \
{ 1: name##_sprites_14;                                                                                                     \
     name##_sprites_right;}                                                                                                 \
switch (FEAT_TRAINS, SELF, name##_sprites_10,                                                                               \
[  set_offset_to(-10),                                                                                                      \
  (prev_vehicle_type_id() == vehid1) ||                                                                                     \
  (prev_vehicle_type_id() == vehid2) ||                                                                                     \
  (prev_vehicle_type_id() == vehid3) ||                                                                                     \
  (prev_vehicle_type_id() == vehid4) ||                                                                                     \
  (prev_vehicle_type_id() == vehid5) ||                                                                                     \
  (prev_vehicle_type_id() == vehid6) ||                                                                                     \
  (prev_vehicle_type_id() == vehid7) ||                                                                                     \
  (prev_vehicle_type_id() == vehid8) ||                                                                                     \
  (prev_vehicle_type_id() == vehid9) ||                                                                                     \
  (prev_vehicle_type_id() == vehid10)])                                                                                     \
{ 1: name##_sprites_12;                                                                                                     \
     name##_sprites_2l;}                                                                                                    \
switch (FEAT_TRAINS, SELF, name##_sprites_8,                                                                                \
[  set_offset_to(-8),                                                                                                       \
  (prev_vehicle_type_id() == vehid1) ||                                                                                     \
  (prev_vehicle_type_id() == vehid2) ||                                                                                     \
  (prev_vehicle_type_id() == vehid3) ||                                                                                     \
  (prev_vehicle_type_id() == vehid4) ||                                                                                     \
  (prev_vehicle_type_id() == vehid5) ||                                                                                     \
  (prev_vehicle_type_id() == vehid6) ||                                                                                     \
  (prev_vehicle_type_id() == vehid7) ||                                                                                     \
  (prev_vehicle_type_id() == vehid8) ||                                                                                     \
  (prev_vehicle_type_id() == vehid9) ||                                                                                     \
  (prev_vehicle_type_id() == vehid10)])                                                                                     \
{ 1: name##_sprites_10;                                                                                                     \
     name##_sprites_right;}                                                                                                 \
switch (FEAT_TRAINS, SELF, name##_sprites_6,                                                                                \
[  set_offset_to(-6),                                                                                                       \
  (prev_vehicle_type_id() == vehid1) ||                                                                                     \
  (prev_vehicle_type_id() == vehid2) ||                                                                                     \
  (prev_vehicle_type_id() == vehid3) ||                                                                                     \
  (prev_vehicle_type_id() == vehid4) ||                                                                                     \
  (prev_vehicle_type_id() == vehid5) ||                                                                                     \
  (prev_vehicle_type_id() == vehid6) ||                                                                                     \
  (prev_vehicle_type_id() == vehid7) ||                                                                                     \
  (prev_vehicle_type_id() == vehid8) ||                                                                                     \
  (prev_vehicle_type_id() == vehid9) ||                                                                                     \
  (prev_vehicle_type_id() == vehid10)])                                                                                     \
{ 1: name##_sprites_8;                                                                                                      \
     name##_sprites_2l;}                                                                                                    \
switch (FEAT_TRAINS, SELF, name##_sprites_4,                                                                                \
[  set_offset_to(-4),                                                                                                       \
  (prev_vehicle_type_id() == vehid1) ||                                                                                     \
  (prev_vehicle_type_id() == vehid2) ||                                                                                     \
  (prev_vehicle_type_id() == vehid3) ||                                                                                     \
  (prev_vehicle_type_id() == vehid4) ||                                                                                     \
  (prev_vehicle_type_id() == vehid5) ||                                                                                     \
  (prev_vehicle_type_id() == vehid6) ||                                                                                     \
  (prev_vehicle_type_id() == vehid7) ||                                                                                     \
  (prev_vehicle_type_id() == vehid8) ||                                                                                     \
  (prev_vehicle_type_id() == vehid9) ||                                                                                     \
  (prev_vehicle_type_id() == vehid10)])                                                                                     \
{ 1: name##_sprites_6;                                                                                                      \
     name##_sprites_right;}                                                                                                 \
switch (FEAT_TRAINS, SELF, name##_sprites_start,                                                                            \
[  set_offset_to(-2),                                                                                                       \
  (prev_vehicle_type_id() == vehid1) ||                                                                                     \
  (prev_vehicle_type_id() == vehid2) ||                                                                                     \
  (prev_vehicle_type_id() == vehid3) ||                                                                                     \
  (prev_vehicle_type_id() == vehid4) ||                                                                                     \
  (prev_vehicle_type_id() == vehid5) ||                                                                                     \
  (prev_vehicle_type_id() == vehid6) ||                                                                                     \
  (prev_vehicle_type_id() == vehid7) ||                                                                                     \
  (prev_vehicle_type_id() == vehid8) ||                                                                                     \
  (prev_vehicle_type_id() == vehid9) ||                                                                                     \
  (prev_vehicle_type_id() == vehid10)])                                                                                     \
{ 1: name##_sprites_4;                                                                                                      \
     name##_sprites_2l; }                                                                                                   \

// Выбор ориентации кабины секции для СМЕ (схема с 6 альтернативами и 4-я средними секциями)
#define engine_direction_template11m4(name, vehid1, vehid2, vehid3, vehid4, vehid5, vehid6, vehid7,  \
                                            vehmid1, vehmid2, vehmid3, vehmid4)                      \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,                                                        \
[ set_offset_to(2),                                                                                  \
  (prev_vehicle_type_id() == vehid1) ||                                                              \
  (prev_vehicle_type_id() == vehid2) ||                                                              \
  (prev_vehicle_type_id() == vehid3) ||                                                              \
  (prev_vehicle_type_id() == vehid4) ||                                                              \
  (prev_vehicle_type_id() == vehid5) ||                                                              \
  (prev_vehicle_type_id() == vehid6) ||                                                              \
  (prev_vehicle_type_id() == vehid7) ||                                                              \
  (position_in_consist == 0) ])                                                                      \
{ 1: name##_sprites_left;                                                                            \
     name##_sprites_right;}                                                                          \
switch (FEAT_TRAINS, SELF, name##_sprites_old,                                                       \
  ((LOAD_TEMP(0) -                                                                                   \
    count_veh_id(vehid1) -                                                                           \
    count_veh_id(vehid2) -                                                                           \
    count_veh_id(vehid3) -                                                                           \
    count_veh_id(vehid4) -                                                                           \
    count_veh_id(vehid5) -                                                                           \
    count_veh_id(vehid6) -                                                                           \
    count_veh_id(vehid7) -                                                                           \
    count_veh_id(vehmid1) -                                                                          \
    count_veh_id(vehmid2) -                                                                          \
    count_veh_id(vehmid3) -                                                                          \
    count_veh_id(vehmid4) + 1) % 2))                                                                 \
{ 1: name##_sprites_2l;                                                                              \
     name##_sprites_right;}                                                                          \
switch (FEAT_TRAINS, SELF, name##_sprites_16,                                                        \
[  set_offset_to(-16),                                                                               \
  ((prev_vehicle_type_id() == vehid1) ||                                                             \
   (prev_vehicle_type_id() == vehid2) ||                                                             \
   (prev_vehicle_type_id() == vehid3) ||                                                             \
   (prev_vehicle_type_id() == vehid4) ||                                                             \
   (prev_vehicle_type_id() == vehid5) ||                                                             \
   (prev_vehicle_type_id() == vehid6) ||                                                             \
   (prev_vehicle_type_id() == vehid7) ) +                                                            \
  (((prev_vehicle_type_id() == vehmid1) ||                                                           \
    (prev_vehicle_type_id() == vehmid2) ||                                                           \
    (prev_vehicle_type_id() == vehmid3) ||                                                           \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                     \
{ 1: name##_sprites_old;                                                                             \
  2: name##_sprites_2l;                                                                              \
     name##_sprites_right;}                                                                          \
switch (FEAT_TRAINS, SELF, name##_sprites_14,                                                        \
[  set_offset_to(-14),                                                                               \
  ((prev_vehicle_type_id() == vehid1) ||                                                             \
   (prev_vehicle_type_id() == vehid2) ||                                                             \
   (prev_vehicle_type_id() == vehid3) ||                                                             \
   (prev_vehicle_type_id() == vehid4) ||                                                             \
   (prev_vehicle_type_id() == vehid5) ||                                                             \
   (prev_vehicle_type_id() == vehid6) ||                                                             \
   (prev_vehicle_type_id() == vehid7)) +                                                             \
  (((prev_vehicle_type_id() == vehmid1) ||                                                           \
    (prev_vehicle_type_id() == vehmid2) ||                                                           \
    (prev_vehicle_type_id() == vehmid3) ||                                                           \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                     \
{ 1: name##_sprites_16;                                                                              \
  2: name##_sprites_right;                                                                           \
     name##_sprites_2l;}                                                                             \
switch (FEAT_TRAINS, SELF, name##_sprites_12,                                                        \
[  set_offset_to(-12),                                                                               \
  ((prev_vehicle_type_id() == vehid1) ||                                                             \
   (prev_vehicle_type_id() == vehid2) ||                                                             \
   (prev_vehicle_type_id() == vehid3) ||                                                             \
   (prev_vehicle_type_id() == vehid4) ||                                                             \
   (prev_vehicle_type_id() == vehid5) ||                                                             \
   (prev_vehicle_type_id() == vehid6) ||                                                             \
   (prev_vehicle_type_id() == vehid7)) +                                                             \
  (((prev_vehicle_type_id() == vehmid1) ||                                                           \
    (prev_vehicle_type_id() == vehmid2) ||                                                           \
    (prev_vehicle_type_id() == vehmid3) ||                                                           \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                     \
{ 1: name##_sprites_14;                                                                              \
  2: name##_sprites_2l;                                                                              \
     name##_sprites_right;}                                                                          \
switch (FEAT_TRAINS, SELF, name##_sprites_10,                                                        \
[  set_offset_to(-10),                                                                               \
  ((prev_vehicle_type_id() == vehid1) ||                                                             \
   (prev_vehicle_type_id() == vehid2) ||                                                             \
   (prev_vehicle_type_id() == vehid3) ||                                                             \
   (prev_vehicle_type_id() == vehid4) ||                                                             \
   (prev_vehicle_type_id() == vehid5) ||                                                             \
   (prev_vehicle_type_id() == vehid6) ||                                                             \
   (prev_vehicle_type_id() == vehid7)) +                                                             \
  (((prev_vehicle_type_id() == vehmid1) ||                                                           \
    (prev_vehicle_type_id() == vehmid2) ||                                                           \
    (prev_vehicle_type_id() == vehmid3) ||                                                           \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                     \
{ 1: name##_sprites_12;                                                                              \
  2: name##_sprites_right;                                                                           \
     name##_sprites_2l;}                                                                             \
switch (FEAT_TRAINS, SELF, name##_sprites_8,                                                         \
[  set_offset_to(-8),                                                                                \
  ((prev_vehicle_type_id() == vehid1) ||                                                             \
   (prev_vehicle_type_id() == vehid2) ||                                                             \
   (prev_vehicle_type_id() == vehid3) ||                                                             \
   (prev_vehicle_type_id() == vehid4) ||                                                             \
   (prev_vehicle_type_id() == vehid5) ||                                                             \
   (prev_vehicle_type_id() == vehid6) ||                                                             \
   (prev_vehicle_type_id() == vehid7)) +                                                             \
  (((prev_vehicle_type_id() == vehmid1) ||                                                           \
    (prev_vehicle_type_id() == vehmid2) ||                                                           \
    (prev_vehicle_type_id() == vehmid3) ||                                                           \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                     \
{ 1: name##_sprites_10;                                                                              \
  2: name##_sprites_2l;                                                                              \
     name##_sprites_right;}                                                                          \
switch (FEAT_TRAINS, SELF, name##_sprites_6,                                                         \
[  set_offset_to(-6),                                                                                \
  ((prev_vehicle_type_id() == vehid1) ||                                                             \
   (prev_vehicle_type_id() == vehid2) ||                                                             \
   (prev_vehicle_type_id() == vehid3) ||                                                             \
   (prev_vehicle_type_id() == vehid4) ||                                                             \
   (prev_vehicle_type_id() == vehid5) ||                                                             \
   (prev_vehicle_type_id() == vehid6) ||                                                             \
   (prev_vehicle_type_id() == vehid7)) +                                                             \
  (((prev_vehicle_type_id() == vehmid1) ||                                                           \
    (prev_vehicle_type_id() == vehmid2) ||                                                           \
    (prev_vehicle_type_id() == vehmid3) ||                                                           \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                     \
{ 1: name##_sprites_8;                                                                               \
  2: name##_sprites_right;                                                                           \
     name##_sprites_2l;}                                                                             \
switch (FEAT_TRAINS, SELF, name##_sprites_4,                                                         \
[  set_offset_to(-4),                                                                                \
  ((prev_vehicle_type_id() == vehid1) ||                                                             \
   (prev_vehicle_type_id() == vehid2) ||                                                             \
   (prev_vehicle_type_id() == vehid3) ||                                                             \
   (prev_vehicle_type_id() == vehid4) ||                                                             \
   (prev_vehicle_type_id() == vehid5) ||                                                             \
   (prev_vehicle_type_id() == vehid6) ||                                                             \
   (prev_vehicle_type_id() == vehid7)) +                                                             \
  (((prev_vehicle_type_id() == vehmid1) ||                                                           \
    (prev_vehicle_type_id() == vehmid2) ||                                                           \
    (prev_vehicle_type_id() == vehmid3) ||                                                           \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                     \
{ 1: name##_sprites_6;                                                                               \
  2: name##_sprites_2l;                                                                              \
     name##_sprites_right;}                                                                          \
switch (FEAT_TRAINS, SELF, name##_sprites_2,                                                         \
[  set_offset_to(-2),                                                                                \
  ((prev_vehicle_type_id() == vehid1) ||                                                             \
   (prev_vehicle_type_id() == vehid2) ||                                                             \
   (prev_vehicle_type_id() == vehid3) ||                                                             \
   (prev_vehicle_type_id() == vehid4) ||                                                             \
   (prev_vehicle_type_id() == vehid5) ||                                                             \
   (prev_vehicle_type_id() == vehid6) ||                                                             \
   (prev_vehicle_type_id() == vehid7)) +                                                             \
  (((prev_vehicle_type_id() == vehmid1) ||                                                           \
    (prev_vehicle_type_id() == vehmid2) ||                                                           \
    (prev_vehicle_type_id() == vehmid3) ||                                                           \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                     \
{ 1: name##_sprites_4;                                                                               \
  2: name##_sprites_right;                                                                           \
     name##_sprites_2l; }                                                                            \
switch (FEAT_TRAINS, SELF, name##_sprites_ml,                                                        \
[  set_offset_to(2),                                                                                 \
  ((prev_vehicle_type_id() == vehmid1) ||                                                            \
   (prev_vehicle_type_id() == vehmid2) ||                                                            \
   (prev_vehicle_type_id() == vehmid3) ||                                                            \
   (prev_vehicle_type_id() == vehmid4)) ])                                                           \
{ 1: name##_sprites_left;                                                                            \
     name##_sprites_2; }                                                                             \
switch (FEAT_TRAINS, SELF, name##_sprites_start,                                                     \
[  set_offset_to(-2),                                                                                \
  ((prev_vehicle_type_id() == vehmid1) ||                                                            \
   (prev_vehicle_type_id() == vehmid2) ||                                                            \
   (prev_vehicle_type_id() == vehmid3) ||                                                            \
   (prev_vehicle_type_id() == vehmid4)) ])                                                           \
{ 1: name##_sprites_right;                                                                           \
     name##_sprites_ml; }                                                                            \

// Выбор ориентации кабины секции для СМЕ (схема с 7 альтернативами и 4-я средними секциями)
#define engine_direction_template12m4(name, vehid1, vehid2, vehid3, vehid4, vehid5, vehid6, vehid7, vehid8,  \
                                            vehmid1, vehmid2, vehmid3, vehmid4)                              \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,                                                                \
[ set_offset_to(2),                                                                                          \
  (prev_vehicle_type_id() == vehid1) ||                                                                      \
  (prev_vehicle_type_id() == vehid2) ||                                                                      \
  (prev_vehicle_type_id() == vehid3) ||                                                                      \
  (prev_vehicle_type_id() == vehid4) ||                                                                      \
  (prev_vehicle_type_id() == vehid5) ||                                                                      \
  (prev_vehicle_type_id() == vehid6) ||                                                                      \
  (prev_vehicle_type_id() == vehid7) ||                                                                      \
  (prev_vehicle_type_id() == vehid8) ||                                                                      \
  (position_in_consist == 0) ])                                                                              \
{ 1: name##_sprites_left;                                                                                    \
     name##_sprites_right;}                                                                                  \
switch (FEAT_TRAINS, SELF, name##_sprites_old,                                                               \
  ((LOAD_TEMP(0) -                                                                                           \
    count_veh_id(vehid1) -                                                                                   \
    count_veh_id(vehid2) -                                                                                   \
    count_veh_id(vehid3) -                                                                                   \
    count_veh_id(vehid4) -                                                                                   \
    count_veh_id(vehid5) -                                                                                   \
    count_veh_id(vehid6) -                                                                                   \
    count_veh_id(vehid7) -                                                                                   \
    count_veh_id(vehid8) -                                                                                   \
    count_veh_id(vehmid1) -                                                                                  \
    count_veh_id(vehmid2) -                                                                                  \
    count_veh_id(vehmid3) -                                                                                  \
    count_veh_id(vehmid4) + 1) % 2))                                                                         \
{ 1: name##_sprites_2l;                                                                                      \
     name##_sprites_right;}                                                                                  \
switch (FEAT_TRAINS, SELF, name##_sprites_16,                                                                \
[  set_offset_to(-16),                                                                                       \
  ((prev_vehicle_type_id() == vehid1) ||                                                                     \
   (prev_vehicle_type_id() == vehid2) ||                                                                     \
   (prev_vehicle_type_id() == vehid3) ||                                                                     \
   (prev_vehicle_type_id() == vehid4) ||                                                                     \
   (prev_vehicle_type_id() == vehid5) ||                                                                     \
   (prev_vehicle_type_id() == vehid6) ||                                                                     \
   (prev_vehicle_type_id() == vehid7) ||                                                                     \
   (prev_vehicle_type_id() == vehid8) ) +                                                                    \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                   \
    (prev_vehicle_type_id() == vehmid2) ||                                                                   \
    (prev_vehicle_type_id() == vehmid3) ||                                                                   \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                             \
{ 1: name##_sprites_old;                                                                                     \
  2: name##_sprites_2l;                                                                                      \
     name##_sprites_right;}                                                                                  \
switch (FEAT_TRAINS, SELF, name##_sprites_14,                                                                \
[  set_offset_to(-14),                                                                                       \
  ((prev_vehicle_type_id() == vehid1) ||                                                                     \
   (prev_vehicle_type_id() == vehid2) ||                                                                     \
   (prev_vehicle_type_id() == vehid3) ||                                                                     \
   (prev_vehicle_type_id() == vehid4) ||                                                                     \
   (prev_vehicle_type_id() == vehid5) ||                                                                     \
   (prev_vehicle_type_id() == vehid6) ||                                                                     \
   (prev_vehicle_type_id() == vehid7) ||                                                                     \
   (prev_vehicle_type_id() == vehid8)) +                                                                     \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                   \
    (prev_vehicle_type_id() == vehmid2) ||                                                                   \
    (prev_vehicle_type_id() == vehmid3) ||                                                                   \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                             \
{ 1: name##_sprites_16;                                                                                      \
  2: name##_sprites_right;                                                                                   \
     name##_sprites_2l;}                                                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_12,                                                                \
[  set_offset_to(-12),                                                                                       \
  ((prev_vehicle_type_id() == vehid1) ||                                                                     \
   (prev_vehicle_type_id() == vehid2) ||                                                                     \
   (prev_vehicle_type_id() == vehid3) ||                                                                     \
   (prev_vehicle_type_id() == vehid4) ||                                                                     \
   (prev_vehicle_type_id() == vehid5) ||                                                                     \
   (prev_vehicle_type_id() == vehid6) ||                                                                     \
   (prev_vehicle_type_id() == vehid7) ||                                                                     \
   (prev_vehicle_type_id() == vehid8)) +                                                                     \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                   \
    (prev_vehicle_type_id() == vehmid2) ||                                                                   \
    (prev_vehicle_type_id() == vehmid3) ||                                                                   \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                             \
{ 1: name##_sprites_14;                                                                                      \
  2: name##_sprites_2l;                                                                                      \
     name##_sprites_right;}                                                                                  \
switch (FEAT_TRAINS, SELF, name##_sprites_10,                                                                \
[  set_offset_to(-10),                                                                                       \
  ((prev_vehicle_type_id() == vehid1) ||                                                                     \
   (prev_vehicle_type_id() == vehid2) ||                                                                     \
   (prev_vehicle_type_id() == vehid3) ||                                                                     \
   (prev_vehicle_type_id() == vehid4) ||                                                                     \
   (prev_vehicle_type_id() == vehid5) ||                                                                     \
   (prev_vehicle_type_id() == vehid6) ||                                                                     \
   (prev_vehicle_type_id() == vehid7) ||                                                                     \
   (prev_vehicle_type_id() == vehid8)) +                                                                     \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                   \
    (prev_vehicle_type_id() == vehmid2) ||                                                                   \
    (prev_vehicle_type_id() == vehmid3) ||                                                                   \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                             \
{ 1: name##_sprites_12;                                                                                      \
  2: name##_sprites_right;                                                                                   \
     name##_sprites_2l;}                                                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_8,                                                                 \
[  set_offset_to(-8),                                                                                        \
  ((prev_vehicle_type_id() == vehid1) ||                                                                     \
   (prev_vehicle_type_id() == vehid2) ||                                                                     \
   (prev_vehicle_type_id() == vehid3) ||                                                                     \
   (prev_vehicle_type_id() == vehid4) ||                                                                     \
   (prev_vehicle_type_id() == vehid5) ||                                                                     \
   (prev_vehicle_type_id() == vehid6) ||                                                                     \
   (prev_vehicle_type_id() == vehid7) ||                                                                     \
   (prev_vehicle_type_id() == vehid8)) +                                                                     \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                   \
    (prev_vehicle_type_id() == vehmid2) ||                                                                   \
    (prev_vehicle_type_id() == vehmid3) ||                                                                   \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                             \
{ 1: name##_sprites_10;                                                                                      \
  2: name##_sprites_2l;                                                                                      \
     name##_sprites_right;}                                                                                  \
switch (FEAT_TRAINS, SELF, name##_sprites_6,                                                                 \
[  set_offset_to(-6),                                                                                        \
  ((prev_vehicle_type_id() == vehid1) ||                                                                     \
   (prev_vehicle_type_id() == vehid2) ||                                                                     \
   (prev_vehicle_type_id() == vehid3) ||                                                                     \
   (prev_vehicle_type_id() == vehid4) ||                                                                     \
   (prev_vehicle_type_id() == vehid5) ||                                                                     \
   (prev_vehicle_type_id() == vehid6) ||                                                                     \
   (prev_vehicle_type_id() == vehid7) ||                                                                     \
   (prev_vehicle_type_id() == vehid8)) +                                                                     \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                   \
    (prev_vehicle_type_id() == vehmid2) ||                                                                   \
    (prev_vehicle_type_id() == vehmid3) ||                                                                   \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                             \
{ 1: name##_sprites_8;                                                                                       \
  2: name##_sprites_right;                                                                                   \
     name##_sprites_2l;}                                                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_4,                                                                 \
[  set_offset_to(-4),                                                                                        \
  ((prev_vehicle_type_id() == vehid1) ||                                                                     \
   (prev_vehicle_type_id() == vehid2) ||                                                                     \
   (prev_vehicle_type_id() == vehid3) ||                                                                     \
   (prev_vehicle_type_id() == vehid4) ||                                                                     \
   (prev_vehicle_type_id() == vehid5) ||                                                                     \
   (prev_vehicle_type_id() == vehid6) ||                                                                     \
   (prev_vehicle_type_id() == vehid7) ||                                                                     \
   (prev_vehicle_type_id() == vehid8)) +                                                                     \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                   \
    (prev_vehicle_type_id() == vehmid2) ||                                                                   \
    (prev_vehicle_type_id() == vehmid3) ||                                                                   \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                             \
{ 1: name##_sprites_6;                                                                                       \
  2: name##_sprites_2l;                                                                                      \
     name##_sprites_right;}                                                                                  \
switch (FEAT_TRAINS, SELF, name##_sprites_2,                                                                 \
[  set_offset_to(-2),                                                                                        \
  ((prev_vehicle_type_id() == vehid1) ||                                                                     \
   (prev_vehicle_type_id() == vehid2) ||                                                                     \
   (prev_vehicle_type_id() == vehid3) ||                                                                     \
   (prev_vehicle_type_id() == vehid4) ||                                                                     \
   (prev_vehicle_type_id() == vehid5) ||                                                                     \
   (prev_vehicle_type_id() == vehid6) ||                                                                     \
   (prev_vehicle_type_id() == vehid7) ||                                                                     \
   (prev_vehicle_type_id() == vehid8)) +                                                                     \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                   \
    (prev_vehicle_type_id() == vehmid2) ||                                                                   \
    (prev_vehicle_type_id() == vehmid3) ||                                                                   \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                             \
{ 1: name##_sprites_4;                                                                                       \
  2: name##_sprites_right;                                                                                   \
     name##_sprites_2l; }                                                                                    \
switch (FEAT_TRAINS, SELF, name##_sprites_ml,                                                                \
[  set_offset_to(2),                                                                                         \
  ((prev_vehicle_type_id() == vehmid1) ||                                                                    \
   (prev_vehicle_type_id() == vehmid2) ||                                                                    \
   (prev_vehicle_type_id() == vehmid3) ||                                                                    \
   (prev_vehicle_type_id() == vehmid4)) ])                                                                   \
{ 1: name##_sprites_left;                                                                                    \
     name##_sprites_2; }                                                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_start,                                                             \
[  set_offset_to(-2),                                                                                        \
  ((prev_vehicle_type_id() == vehmid1) ||                                                                    \
   (prev_vehicle_type_id() == vehmid2) ||                                                                    \
   (prev_vehicle_type_id() == vehmid3) ||                                                                    \
   (prev_vehicle_type_id() == vehmid4)) ])                                                                   \
{ 1: name##_sprites_right;                                                                                   \
     name##_sprites_ml; }                                                                                    \

// Выбор ориентации кабины секции для СМЕ (схема с 9 альтернативами и 4-я средними секциями)
#define engine_direction_template14m4(name, vehid1, vehid2, vehid3, vehid4, vehid5, vehid6, vehid7, vehid8, vehid9, vehid10,  \
                                      vehmid1, vehmid2, vehmid3, vehmid4)                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_2l,                                                                                 \
[ set_offset_to(2),                                                                                                           \
  (prev_vehicle_type_id() == vehid1) ||                                                                                       \
  (prev_vehicle_type_id() == vehid2) ||                                                                                       \
  (prev_vehicle_type_id() == vehid3) ||                                                                                       \
  (prev_vehicle_type_id() == vehid4) ||                                                                                       \
  (prev_vehicle_type_id() == vehid5) ||                                                                                       \
  (prev_vehicle_type_id() == vehid6) ||                                                                                       \
  (prev_vehicle_type_id() == vehid7) ||                                                                                       \
  (prev_vehicle_type_id() == vehid8) ||                                                                                       \
  (prev_vehicle_type_id() == vehid9) ||                                                                                       \
  (prev_vehicle_type_id() == vehid10) ||                                                                                      \
  (position_in_consist == 0) ])                                                                                               \
{ 1: name##_sprites_left;                                                                                                     \
     name##_sprites_right;}                                                                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_old,                                                                                \
  ((LOAD_TEMP(0) -                                                                                                            \
    count_veh_id(vehid1) -                                                                                                    \
    count_veh_id(vehid2) -                                                                                                    \
    count_veh_id(vehid3) -                                                                                                    \
    count_veh_id(vehid4) -                                                                                                    \
    count_veh_id(vehid5) -                                                                                                    \
    count_veh_id(vehid6) -                                                                                                    \
    count_veh_id(vehid7) -                                                                                                    \
    count_veh_id(vehid8) -                                                                                                    \
    count_veh_id(vehid9) -                                                                                                    \
    count_veh_id(vehid10) -                                                                                                   \
    count_veh_id(vehmid1) -                                                                                                   \
    count_veh_id(vehmid2) -                                                                                                   \
    count_veh_id(vehmid3) -                                                                                                   \
    count_veh_id(vehmid4) + 1) % 2))                                                                                          \
{ 1: name##_sprites_2l;                                                                                                       \
     name##_sprites_right;}                                                                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_16,                                                                                 \
[  set_offset_to(-16),                                                                                                        \
  ((prev_vehicle_type_id() == vehid1) ||                                                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                                                      \
   (prev_vehicle_type_id() == vehid4) ||                                                                                      \
   (prev_vehicle_type_id() == vehid5) ||                                                                                      \
   (prev_vehicle_type_id() == vehid6) ||                                                                                      \
   (prev_vehicle_type_id() == vehid7) ||                                                                                      \
   (prev_vehicle_type_id() == vehid8) ||                                                                                      \
   (prev_vehicle_type_id() == vehid9) ||                                                                                      \
   (prev_vehicle_type_id() == vehid10) ) +                                                                                    \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid2) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid3) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                                              \
{ 1: name##_sprites_old;                                                                                                      \
  2: name##_sprites_2l;                                                                                                       \
     name##_sprites_right;}                                                                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_14,                                                                                 \
[  set_offset_to(-14),                                                                                                        \
  ((prev_vehicle_type_id() == vehid1) ||                                                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                                                      \
   (prev_vehicle_type_id() == vehid4) ||                                                                                      \
   (prev_vehicle_type_id() == vehid5) ||                                                                                      \
   (prev_vehicle_type_id() == vehid6) ||                                                                                      \
   (prev_vehicle_type_id() == vehid7) ||                                                                                      \
   (prev_vehicle_type_id() == vehid8) ||                                                                                      \
   (prev_vehicle_type_id() == vehid9) ||                                                                                      \
   (prev_vehicle_type_id() == vehid10)) +                                                                                     \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid2) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid3) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                                              \
{ 1: name##_sprites_16;                                                                                                       \
  2: name##_sprites_right;                                                                                                    \
     name##_sprites_2l;}                                                                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_12,                                                                                 \
[  set_offset_to(-12),                                                                                                        \
  ((prev_vehicle_type_id() == vehid1) ||                                                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                                                      \
   (prev_vehicle_type_id() == vehid4) ||                                                                                      \
   (prev_vehicle_type_id() == vehid5) ||                                                                                      \
   (prev_vehicle_type_id() == vehid6) ||                                                                                      \
   (prev_vehicle_type_id() == vehid7) ||                                                                                      \
   (prev_vehicle_type_id() == vehid8) ||                                                                                      \
   (prev_vehicle_type_id() == vehid9) ||                                                                                      \
   (prev_vehicle_type_id() == vehid10)) +                                                                                     \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid2) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid3) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                                              \
{ 1: name##_sprites_14;                                                                                                       \
  2: name##_sprites_2l;                                                                                                       \
     name##_sprites_right;}                                                                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_10,                                                                                 \
[  set_offset_to(-10),                                                                                                        \
  ((prev_vehicle_type_id() == vehid1) ||                                                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                                                      \
   (prev_vehicle_type_id() == vehid4) ||                                                                                      \
   (prev_vehicle_type_id() == vehid5) ||                                                                                      \
   (prev_vehicle_type_id() == vehid6) ||                                                                                      \
   (prev_vehicle_type_id() == vehid7) ||                                                                                      \
   (prev_vehicle_type_id() == vehid8) ||                                                                                      \
   (prev_vehicle_type_id() == vehid9) ||                                                                                      \
   (prev_vehicle_type_id() == vehid10)) +                                                                                     \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid2) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid3) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                                              \
{ 1: name##_sprites_12;                                                                                                       \
  2: name##_sprites_right;                                                                                                    \
     name##_sprites_2l;}                                                                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_8,                                                                                  \
[  set_offset_to(-8),                                                                                                         \
  ((prev_vehicle_type_id() == vehid1) ||                                                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                                                      \
   (prev_vehicle_type_id() == vehid4) ||                                                                                      \
   (prev_vehicle_type_id() == vehid5) ||                                                                                      \
   (prev_vehicle_type_id() == vehid6) ||                                                                                      \
   (prev_vehicle_type_id() == vehid7) ||                                                                                      \
   (prev_vehicle_type_id() == vehid8) ||                                                                                      \
   (prev_vehicle_type_id() == vehid9) ||                                                                                      \
   (prev_vehicle_type_id() == vehid10)) +                                                                                     \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid2) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid3) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                                              \
{ 1: name##_sprites_10;                                                                                                       \
  2: name##_sprites_2l;                                                                                                       \
     name##_sprites_right;}                                                                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_6,                                                                                  \
[  set_offset_to(-6),                                                                                                         \
  ((prev_vehicle_type_id() == vehid1) ||                                                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                                                      \
   (prev_vehicle_type_id() == vehid4) ||                                                                                      \
   (prev_vehicle_type_id() == vehid5) ||                                                                                      \
   (prev_vehicle_type_id() == vehid6) ||                                                                                      \
   (prev_vehicle_type_id() == vehid7) ||                                                                                      \
   (prev_vehicle_type_id() == vehid8) ||                                                                                      \
   (prev_vehicle_type_id() == vehid9) ||                                                                                      \
   (prev_vehicle_type_id() == vehid10)) +                                                                                     \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid2) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid3) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                                              \
{ 1: name##_sprites_8;                                                                                                        \
  2: name##_sprites_right;                                                                                                    \
     name##_sprites_2l;}                                                                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_4,                                                                                  \
[  set_offset_to(-4),                                                                                                         \
  ((prev_vehicle_type_id() == vehid1) ||                                                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                                                      \
   (prev_vehicle_type_id() == vehid4) ||                                                                                      \
   (prev_vehicle_type_id() == vehid5) ||                                                                                      \
   (prev_vehicle_type_id() == vehid6) ||                                                                                      \
   (prev_vehicle_type_id() == vehid7) ||                                                                                      \
   (prev_vehicle_type_id() == vehid8) ||                                                                                      \
   (prev_vehicle_type_id() == vehid9) ||                                                                                      \
   (prev_vehicle_type_id() == vehid10)) +                                                                                     \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid2) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid3) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                                              \
{ 1: name##_sprites_6;                                                                                                        \
  2: name##_sprites_2l;                                                                                                       \
     name##_sprites_right;}                                                                                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_2,                                                                                  \
[  set_offset_to(-2),                                                                                                         \
  ((prev_vehicle_type_id() == vehid1) ||                                                                                      \
   (prev_vehicle_type_id() == vehid2) ||                                                                                      \
   (prev_vehicle_type_id() == vehid3) ||                                                                                      \
   (prev_vehicle_type_id() == vehid4) ||                                                                                      \
   (prev_vehicle_type_id() == vehid5) ||                                                                                      \
   (prev_vehicle_type_id() == vehid6) ||                                                                                      \
   (prev_vehicle_type_id() == vehid7) ||                                                                                      \
   (prev_vehicle_type_id() == vehid8) ||                                                                                      \
   (prev_vehicle_type_id() == vehid9) ||                                                                                      \
   (prev_vehicle_type_id() == vehid10)) +                                                                                     \
  (((prev_vehicle_type_id() == vehmid1) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid2) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid3) ||                                                                                    \
    (prev_vehicle_type_id() == vehmid4)) * 2) ])                                                                              \
{ 1: name##_sprites_4;                                                                                                        \
  2: name##_sprites_right;                                                                                                    \
     name##_sprites_2l; }                                                                                                     \
switch (FEAT_TRAINS, SELF, name##_sprites_ml,                                                                                 \
[  set_offset_to(2),                                                                                                          \
  ((prev_vehicle_type_id() == vehmid1) ||                                                                                     \
   (prev_vehicle_type_id() == vehmid2) ||                                                                                     \
   (prev_vehicle_type_id() == vehmid3) ||                                                                                     \
   (prev_vehicle_type_id() == vehmid4)) ])                                                                                    \
{ 1: name##_sprites_left;                                                                                                     \
     name##_sprites_2; }                                                                                                      \
switch (FEAT_TRAINS, SELF, name##_sprites_start,                                                                              \
[  set_offset_to(-2),                                                                                                         \
  ((prev_vehicle_type_id() == vehmid1) ||                                                                                     \
   (prev_vehicle_type_id() == vehmid2) ||                                                                                     \
   (prev_vehicle_type_id() == vehmid3) ||                                                                                     \
   (prev_vehicle_type_id() == vehmid4)) ])                                                                                    \
{ 1: name##_sprites_right;                                                                                                    \
     name##_sprites_ml; }                                                                                                     \

// Выбор ориентации бустера
#define engine_direction_template_buster(name)             \
switch (FEAT_TRAINS, SELF, name##_sprites_start,           \
[  set_offset_to(-2), prev_vehicle_randombits() & 0x01 ])  \
{ 1: name##_sprites_left;                                  \
     name##_sprites_right; }                               \

// Выбор ориентации двойного бустера без альтернатив (обе секции ориентируются в одну сторону)
#define engine_direction_template_buster2(name, vehmid)   \
switch (FEAT_TRAINS, SELF, name##_sprites2,               \
[  set_offset_to(-2), prev_vehicle_randombits() & 0x01])  \
{ 1: name##_sprites_left;                                 \
     name##_sprites_right; }                              \
switch (FEAT_TRAINS, SELF, name##_sprites1,               \
[  set_offset_to(-4), prev_vehicle_randombits() & 0x01])  \
{ 1: name##_sprites_left;                                 \
     name##_sprites_right; }                              \
switch (FEAT_TRAINS, SELF, name##_sprites_start,          \
[  set_offset_to(-2), prev_vehicle_type_id() == vehmid])  \
{ 1: name##_sprites1;                                     \
     name##_sprites2; }                                   \

// Выбор ориентации двойного бустера без альтернатив (обе секции ориентируются в разные стороны)
#define engine_direction_template_buster2r(name, vehmid)  \
switch (FEAT_TRAINS, SELF, name##_sprites2,               \
[  set_offset_to(-2), prev_vehicle_randombits() & 0x01])  \
{ 1: name##_sprites_left;                                 \
     name##_sprites_right; }                              \
switch (FEAT_TRAINS, SELF, name##_sprites1,               \
[  set_offset_to(2), prev_vehicle_type_id() == vehmid])   \
{ 1: name##_sprites_left;                                 \
     name##_sprites2; }                                   \
switch (FEAT_TRAINS, SELF, name##_sprites_start,          \
[  set_offset_to(-2), prev_vehicle_type_id() == vehmid])  \
{ 1: name##_sprites_right;                                \
     name##_sprites1; }                                   \

// выбор графики паровоза с тендером
#define steamer_direction_template(name, lastname)                       \
switch (FEAT_TRAINS, SELF, name##lastname, position_in_articulated_veh)  \
{ 0: name##_engine##lastname;                                            \
  2: name##_tender##lastname;                                            \
     dummy_sprites; }                                                    \

// Простой Шаблон расчёта ориентации МВПС
#define car_direction_calculation_template_s(name, prev_vehid)  \
switch (FEAT_TRAINS, SELF, name##_direction_template,           \
[  set_offset_to(-2),                                           \
   prev_vehicle_type_id() == prev_vehid])                       \
{ 1: name##_direction_left;                                     \
     name##_direction_right; }                                  \

// прицепной
#define car_direction_template(name)                               \
switch (FEAT_TRAINS, SELF, name##_sprites_start, random_bits & 1)  \
{ 1: name##_sprites_left;                                          \
     name##_sprites_right; }                                       \

#define MU_car_dir_direction_template(name)                             \
switch (FEAT_TRAINS, SELF, name##_direction_template, random_bits & 1)  \
{ 1: name##_sprites_left;                                               \
     name##_sprites_right; }                                            \

// end
