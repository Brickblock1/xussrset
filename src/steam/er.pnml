// steam_er uses steam_e_6606

#define PROP_steam_er_1933_CF  14
#define PROP_steam_er_1933_RC  314
#define PROP_steam_er_1933_SD  55
#define PROP_steam_er_1933_WT  84+68
#define PROP_steam_er_1933_TE  229.0
#define PROP_steam_er_1933_PR  1500
#define PROP_steam_er_1933_CC  0

#define PROP_steam_er_1946_CF  14
#define PROP_steam_er_1946_RC  321
#define PROP_steam_er_1946_SD  65
#define PROP_steam_er_1946_WT  85+77
#define PROP_steam_er_1946_TE  229.0
#define PROP_steam_er_1946_PR  1500
#define PROP_steam_er_1946_CC  0

#define PROP_steam_er_1948_CF  14
#define PROP_steam_er_1948_RC  325
#define PROP_steam_er_1948_SD  65
#define PROP_steam_er_1948_WT  85+68
#define PROP_steam_er_1948_TE  229.0
#define PROP_steam_er_1948_PR  1500
#define PROP_steam_er_1948_CC  0

#define IMAGEFILE  "src/steam/er.png"
purchase_sprites(steam_er_v1, 0, 0)
purchase_sprites(steam_er_v2, 100, 0)
steam_sprites(7, steam_er_engine, 32, 40)
tender_sprites(6, steam_er_v1_tender, 447, 40)
#undef IMAGEFILE
purchase_sprites_select(steam_er, 1948)

map_sprites(steam_er_1933_purchase_sprites, steam_er_v1_purchase_sprites)
map_sprites(steam_er_1946_purchase_sprites, steam_er_v1_purchase_sprites)
map_sprites(steam_er_1948_purchase_sprites, steam_er_v2_purchase_sprites)

switch (FEAT_TRAINS, SELF, steam_er_tender_sprites_start,
  build_year >= 1948)
{
  0: steam_e_6606_tender_sprites_start;
     steam_er_v1_tender_sprites_start;
}

steamer_direction_template(steam_er, _sprites_start)
long_vehicle(steam_er)

switch (FEAT_TRAINS, SELF, steam_er_1933_running_cost_factor,
[  STORE_TEMP(179, 0),  // Моторы
   STORE_TEMP(25, 1),   // Бригада
   STORE_TEMP(63, 2),   // Износ
   STORE_TEMP(0, 3),    // Сопровождение
   STORE_TEMP(44, 4),   // ТО
   STORE_TEMP(3, 5),    // Сертификация

   STORE_TEMP(PROP_steam_er_1933_SD + 10 * (current_year >= 1936), 6),  // Скорость
   STORE_TEMP(PROP_steam_er_1933_WT, 7),                                // Тара
   STORE_TEMP(PROP_steam_er_1933_WT, 8)])                               // Максимальная масса
{ all_running_cost_factor; }                                            // 314

switch (FEAT_TRAINS, SELF, steam_er_1946_running_cost_factor,
[  STORE_TEMP(183, 0),  // Моторы
   STORE_TEMP(26, 1),   // Бригада
   STORE_TEMP(64, 2),   // Износ
   STORE_TEMP(0, 3),    // Сопровождение
   STORE_TEMP(45, 4),   // ТО
   STORE_TEMP(3, 5),    // Сертификация

   STORE_TEMP(PROP_steam_er_1946_SD, 6),   // Скорость
   STORE_TEMP(PROP_steam_er_1946_WT, 7),   // Тара
   STORE_TEMP(PROP_steam_er_1946_WT, 8)])  // Максимальная масса
{ all_running_cost_factor; }               // 321

switch (FEAT_TRAINS, SELF, steam_er_1948_running_cost_factor,
[  STORE_TEMP(185, 0),  // Моторы
   STORE_TEMP(26, 1),   // Бригада
   STORE_TEMP(65, 2),   // Износ
   STORE_TEMP(0, 3),    // Сопровождение
   STORE_TEMP(46, 4),   // ТО
   STORE_TEMP(3, 5),    // Сертификация

   STORE_TEMP(PROP_steam_er_1948_SD, 6),   // Скорость
   STORE_TEMP(PROP_steam_er_1948_WT, 7),   // Тара
   STORE_TEMP(PROP_steam_er_1948_WT, 8)])  // Максимальная масса
{ all_running_cost_factor; }               // 325

engine_change_build_after2(steam_er_running_cost_factor, steam_er_1933_running_cost_factor,
                                                         steam_er_1946_running_cost_factor, 1946,
                                                         steam_er_1948_running_cost_factor, 1948)
engine_tender(steam_er)
engine_tender_length_change_build_after(steam_er, 6, 1, 4, 1,
                                                  6, 1, 5, 1, 1948)
engine_weight_change_build_after2(steam_er, PROP_steam_er_1933_WT,
                                            PROP_steam_er_1946_WT, 1946,
                                            PROP_steam_er_1948_WT, 1948)
engine_TE_change_build_after2(steam_er, get_tec_int(PROP_steam_er_1933_TE, PROP_steam_er_1933_WT),
                                        get_tec_int(PROP_steam_er_1946_TE, PROP_steam_er_1946_WT), 1946,
                                        get_tec_int(PROP_steam_er_1948_TE, PROP_steam_er_1948_WT), 1948)
engine_cost_change_build_after2(steam_er, PROP_steam_er_1933_CF,
                                          PROP_steam_er_1946_CF, 1946,
                                          PROP_steam_er_1948_CF, 1948)
engine_speed_change_after(steam_er_a1936, PROP_steam_er_1933_SD,
                                          65, 1936)
engine_speed(steam_er_a1933, PROP_steam_er_1933_SD)
engine_change_build_after(steam_er_speed, steam_er_a1933_speed,
                                          steam_er_a1936_speed, 1936)
engine_penalise_speed0(steam_er)
name_in_group(steam_er, string(STR_NAME_IN_GROUP, string(STR_NAME_E_SERIES), string(STR_NAME_ER)),
                        string(STR_NAME_IN_GROUP, string(STR_NAME_E_SERIES), string(STR_LONGNAME_ER)))
hint_engine(steam_er_b1936,
     STR_PURCHASE_HINT_ENGINE_TYPE_FREIGHT_STEAM,
     STR_PURCHASE_HINT_SECTIONS_1,
     1933, 1957,
     string(STR_PURCHASE_HINT_FACTORY_KOLOMNA))
hint_engine_comment(steam_er_a1936,
     STR_PURCHASE_HINT_ENGINE_TYPE_FREIGHT_STEAM,
     STR_PURCHASE_HINT_SECTIONS_1,
     1933, 1957,
     string(STR_PURCHASE_HINT_FACTORY_KOLOMNA),
     string(STR_PURCHASE_HINT_SPEED_CHANGE_ON_DATE, 65, 1936))
hint_engine_2fact(steam_er_a1947,
     STR_PURCHASE_HINT_ENGINE_TYPE_FREIGHT_STEAM,
     STR_PURCHASE_HINT_SECTIONS_1,
     1933, 1957,
     string(STR_PURCHASE_HINT_FACTORY_KOLOMNA),
     fact_mavag())
hint_engine_5fact(steam_er_a1949,
     STR_PURCHASE_HINT_ENGINE_TYPE_FREIGHT_STEAM,
     STR_PURCHASE_HINT_SECTIONS_1,
     1933, 1957,
     string(STR_PURCHASE_HINT_FACTORY_KOLOMNA),
     fact_chkd(),
     string(STR_PURCHASE_HINT_FACTORY_POZNAN),
     fact_mavag(),
     fact_skoda())
hint_engine_4fact(steam_er_a1957,
     STR_PURCHASE_HINT_ENGINE_TYPE_FREIGHT_STEAM,
     STR_PURCHASE_HINT_SECTIONS_1,
     1933, 1957,
     string(STR_PURCHASE_HINT_FACTORY_KOLOMNA),
     fact_chkd(),
     string(STR_PURCHASE_HINT_FACTORY_POZNAN),
     fact_skoda())
hint_change_after4(steam_er, 1936, 1947, 1949, 1957)
map_sprites(steam_er_1933_additional_text, steam_er_additional_text)
map_sprites(steam_er_1946_additional_text, steam_er_additional_text)
map_sprites(steam_er_1948_additional_text, steam_er_additional_text)
engine_change_build_after2(steam_er_purchase_speed, return PROP_steam_er_1933_SD,
                                                    return PROP_steam_er_1946_SD, 1946,
                                                    return PROP_steam_er_1948_SD, 1948)

item (FEAT_TRAINS, steam_er, 333) {
  property {
    name: string(STR_NAME_ER);
    vehicle_dates(1933, 1957, 40, 10, 6, PROP_steam_er_1933_CF)
    vehicle_cargo()
    vehicle_steam(PROP_steam_er_1933_PR, PROP_steam_er_1933_WT, PROP_steam_er_1933_TE)
    vehicle_group(steam_e_group)
  }
  graphics {
    purchase_menu_calc(steam_er_cost_factor,
                       steam_er_running_cost_factor,
                       steam_er_purchase_speed,
                       steam_er_weight,
                       steam_er_tractive_effort_coefficient,
                       return PROP_steam_er_1933_PR,
                       return PROP_steam_er_1933_CC)
                additional_text: steam_er_additional_text;
               articulated_part: steam_er_articulated_part;
           bitmask_vehicle_info: steam_er_bitmask_vehicle_info;
               can_attach_wagon: any_can_attach_wagon;
                 cargo_capacity: return PROP_steam_er_1933_CC;
                 colour_mapping: any_cc_colour;
                  create_effect: steam_e_6606_create_effect;
                        default: steam_er_sprites;
                         length: steam_er_length;
                           name: steam_er_name;
                       purchase: steam_er_purchase_sprites;
            running_cost_factor: steam_er_running_cost_factor;
                          speed: steam_er_speed;
                     start_stop: any_start_stop;
    tractive_effort_coefficient: steam_er_tractive_effort_coefficient;
                         weight: steam_er_weight;
  }
}

long_name_template(steam_er, STR_LONGNAME_ER)
models_default_cargo_template(steam_er)
allow_steamer(steam_er)
